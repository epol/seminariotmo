\documentclass[a4paper]{article}
%\documentclass[a4paper,10pt]{article}

\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsthm}
% \usepackage{xfrac}
% \usepackage[all]{xy}
\usepackage{mathtools}
\usepackage{graphicx}
% \usepackage{fullpage}
\usepackage{hyperref}
\usepackage[T1]{fontenc}
\usepackage[utf8x]{inputenc}
\usepackage[italian]{babel}
%\usepackage{lmodern}

% \usepackage{pdftricks}
% \begin{psinputs}
%    \usepackage{pstricks}
%    \usepackage{multido}
% \end{psinputs}

\usepackage{ulem}

\usepackage{tikz}
\usetikzlibrary{arrows}

% \setlength{\parindent}{0in}

\newcounter{counter1}

\theoremstyle{plain}
\newtheorem{myteo}[counter1]{Teorema}
\newtheorem{mylem}[counter1]{Lemma}
\newtheorem{mypro}[counter1]{Proposizione}
\newtheorem{mycor}[counter1]{Corollario}
\newtheorem*{myteo*}{Teorema}
\newtheorem*{mylem*}{Lemma}
\newtheorem*{mypro*}{Proposizione}
\newtheorem*{mycor*}{Corollario}

\theoremstyle{definition}
\newtheorem{mydef}[counter1]{Definizione}
\newtheorem{myes}[counter1]{Esempio}
\newtheorem{myex}[counter1]{Esercizio}
\newtheorem*{mydef*}{Definizione}
\newtheorem*{myes*}{Esempio}
\newtheorem*{myex*}{Esercizio}

\theoremstyle{remark}
\newtheorem{mynot}[counter1]{Nota}
\newtheorem{myoss}[counter1]{Osservazione}
\newtheorem*{mynot*}{Nota}
\newtheorem*{myoss*}{Osservazione}

\newcommand{\obar}[1]{\overline{#1}}
\newcommand{\ubar}[1]{\underline{#1}}

\newcommand{\set}[1]{\left\{#1\right\}}
\newcommand{\pa}[1]{\left(#1\right)}
\newcommand{\ang}[1]{\left<#1\right>}
\newcommand{\bra}[1]{\left[#1\right]}
\newcommand{\abs}[1]{\left|#1\right|}
\newcommand{\norm}[1]{\left\|#1\right\|}

\newcommand{\pfrac}[2]{\pa{\frac{#1}{#2}}}
\newcommand{\bfrac}[2]{\bra{\frac{#1}{#2}}}
\newcommand{\psfrac}[2]{\pa{\sfrac{#1}{#2}}}
\newcommand{\bsfrac}[2]{\bra{\sfrac{#1}{#2}}}

\newcommand{\der}[2]{\frac{\partial #1}{\partial #2}}
\newcommand{\pder}[2]{\pfrac{\partial #1}{\partial #2}}
\newcommand{\sder}[2]{\sfrac{\partial #1}{\partial #2}}
\newcommand{\psder}[2]{\psfrac{\partial #1}{\partial #2}}

\newcommand{\intl}{\int \limits}

\DeclareMathOperator{\de}{d}
\DeclareMathOperator{\id}{Id}
\DeclareMathOperator{\len}{len}

\DeclareMathOperator{\gl}{GL}
\DeclareMathOperator{\aff}{Aff}
\DeclareMathOperator{\isom}{Isom}

\title{Problemi di instradamento su reti}
\date{\today}
\author{Enrico Polesel}

\begin{document}
\maketitle

\section{Introduzione ed esempi}

Nello studio dei trasporti e delle reti di telecomunicazioni è
importante riuscire a prevedere il comportamento degli utenti e la
distribuzione del loro traffico in funzione dello stato della rete e
delle decisioni prese dai gestori della rete.

Tra i molti esempi di reti a cui potrebbe adattarsi il nostro modello
ne citiamo due molto diffusi: la \textbf{rete stradale} e la
\textbf{rete internet}. L'esperienza ci dice che non tutte le strade
che congiungono due località sono equivalenti: strade diverse potranno
avere tempi di percorrenza diversi (che potranno dipendere dal
traffico presente). Per questo ci servirà introdurre dei costi che,
nei nostri due esempi, si tradurranno in tempi di percorrenza (detti
anche \textit{latenze} nell'ambito della rete internet).

Vedremo alcuni modi in cui potrà disporsi il traffico sulle nostre
reti, il più importante è l'\textbf{equilibrio di Wardrop} che bene
esprime la volontà di ogni utente di minimizzare il proprio costo
arrivando all'equilibrio in cui ``non esistono scorciatoie''.

Infine vedremo anche, se pur in un modello molto semplificato, cosa
succede quando al tempo di percorrenza aggiungiamo anche il costo
economico fissato da uno o più fornitori che tentano di massimizzare
il proprio guadagno.

\section{Modello e instradamento socialmente ottimo}

\subsection{Modello}

Modellizziamo le nostre reti come grafi diretti dove per ogni arco è
data una funzione costo in funzione del traffico che attraversa l'arco
stesso (il costo è quindi una funzione ``locale'').

Supponiamo che le funzioni costo siano continue, non negative e non
decrescenti. Quest'ultima ipotesi sulla monotonia può essere
giustificata dall'idea che le prestazioni di una strada (o un
collegamento) diminuiscono con l'aumentare del traffico.

Dato il traffico che deve attraversare la nostra rete, lo dividiamo in
base alle coppie ``sorgente-destinazione'' e indicizziamo queste
coppie con un qualche insieme $W$, descriviamo il traffico con tre
vettori: vettore delle sorgenti, vettore delle destinazioni e vettore
delle quantità di traffico da instradare.

Supponiamo tutto il traffico \textbf{infinitamente divisibile}, cioè
possiamo dividerlo sulle nostre strade in rapporti arbitrari. Questo
confligge con la realtà delle reti stradali e internet in cui il
traffico è discreto, ma ne descrive bene il comportamento quando la
quantità di utenti è sufficientemente grande.

Infine supponiamo che ci venga fornito per ogni coppia
``sorgente-destinazione'' l'insieme dei percorsi non contenenti cicli
che le congiungono. Questo ci permette di non dover trattare la
costruzione di questi insiemi (che comunque è un problema
semplice\footnote{\url{https://xlinux.nist.gov/dads/HTML/allSimplePaths.html}}

In figura \ref{fig:esempio-rete} si vede un esempio di rete.

\begin{figure}[ht]
  \centering
  \begin{tikzpicture}[mnode/.style={circle,fill=blue!20},>=latex]
    \node[mnode] (1) at (0,0) {1};
    \node[mnode] (2) at (2,2) {2};
    \node[mnode] (3) at (4,2) {3};
    \node[mnode] (4) at (3,-2) {4};
    \node[mnode] (5) at (6,0) {5};
    \draw [->] (1) to [bend left] (2);
    \node at (1,1) {$l_1(x_1)$};
    \draw [->] (2) to [bend right] (3);
    \node at (3,2.7) {$l_2(x_2)$};
    \draw [->] (3) to [bend right] (2);
    \node at (3,1.3) {$l_3(x_3)$};
    \draw [->] (3) to [bend left] (5);
    \node at (5.5,1.7) {$l_4(x_4)$};
    \draw [->] (1) to [bend right] (4);
    \node at (0.6,-1.7) {$l_5(x_5)$};
    \draw [->] (3) -- (4);
    \node at (4,0) {$l_6(x_6)$};
    \draw [->] (4) -- (2);
    \node at (2,0) {$l_7(x_7)$};
    \draw [->] (4) to [bend right] (5);
    \node at (5,-1) {$l_8(x_8)$};

    \node (S1) at (-2,0) {};
    \node (S2) at (-1,2) {};
    \node (T1) at (8,0) {};
    \node (T2) at (5.5,-2) {};
    \draw[->] (S1) -- node[above]{traffico 1} (1);
    \draw[->] (5) -- node[above]{traffico 1} (T1);
    \draw[->] (S2) -- node[above]{traffico 2} (2);
    \draw[->] (4) -- node[below]{traffico 2} (T2);
  \end{tikzpicture}
  \caption{Esempio di rete e traffico}
  \label{fig:esempio-rete}
\end{figure}

Formalizzando quanto appena detto, un'instanza del nostro problema è
data dalla seguente definizione:

\begin{mydef}[Instanza di instradamento]
  Un'\textbf{istanza di instradamento} (\textit{routing instance} o
  più brevemente \textbf{rete}) è $R=(V,A,P,s,t,X,l)$ con:
  \begin{itemize}
  \item $(V,A)$ il grafo diretto,
  \item $s = \bra{s_i}_{i\in W}$ vettore delle sorgenti (per un opportuno $W$),
  \item $t = \bra{t_i}_{i\in W}$ vettore delle destinazioni,
  \item $P = \cup _{i\in W} P_i$ con $P_i$ insieme dei
    percorsi da $s_i$ a $t_i$,
  \item $X = \bra{X_i}_{i\in W}$ dove $X_i$ rappresenta la quantità di
    traffico da instradare da $s_i$ a $t_i$,
  \item $l = \bra{l_j}_{j\in A}$ dove $l_j(x_j)$ è il costo del link
    $j$ con un traffico $x_j$.
  \end{itemize}
  Supponiamo che le funzioni $l_j$ siano \textbf{non negative},
  \textbf{continue} e \textbf{non decrescenti}.
\end{mydef}

Chiamiamo $\mathcal{R}$ l'insieme di tutte le possibili istanze,
$\mathcal{R}^{aff}$ il sottoinsieme delle istanze con funzioni costo
affini, $\mathcal{R}^{conv}$ il sottoinsieme delle istanze con funzioni costo
convesse e $\mathcal{R}^{conc}$ il sottoinsieme delle istanze con
funzioni costo concave.

Per descrivere un possibile schema secondo cui il traffico può
disporsi utilizziamo due vettori: $\bra{x_j}_{j\in A}$ per descrivere
il traffico su ogni arco e $\bra{x_p}_{p\in P}$ per descrivere il
traffico su ogni percorso.

Questi due vettori (che esprimiamo come un unico vettore $x$)
descrivono un possibile schema se soddisfano la definzione di soluzione:

\begin{mydef}[Soluzione di un'instanza]
  Data un'istanza $R=(V,A,P,s,t,X,l)$ un vettore
  $x = \bra{x_j}_{j\in A} \cup \bra{x_p}_{p\in P}$ è \textbf{soluzione} se:
  \begin{itemize}
  \item instradiamo solo quantità non negative di traffico: \[ \forall p\in P\;\; x_p \ge 0\]
  \item il traffico su ogni arco è dato dalla somma del traffico di
    ogni percorso che lo attraversa: \[ \forall j\in A\;\; x_j = \sum_{p\in P,p\ni j} x_p\]
  \item la quantità di traffico instradata tra ogni coppia è proprio
    quella richiesta dal problema: \[\forall i\in W\;\; \sum_{p\in P_i} x_p = X_i\]
  \end{itemize}
\end{mydef}

Dato un percorso $p\in P$ e una soluzione $x$ possiamo scrivere il
costo pagato dagl'utenti instradati su quel percorso come:
\[ c_p\pa{x} = \sum _{j\in p} l_j\pa{x_j} \]
sommando il costo pagato su ogni percorso pesato sulla quantit\`a di
traffico di quel percorso otteniamo
\[ \sum _{p\in P} \pa{ x_p \sum _{j\in p} l_j\pa{x_j}}  = \sum _{j\in
    A} l_j\pa{x_j}x_j \]
questa quantit\`a rappresenta il costo pagato complessivamente dagli utenti.

\begin{mydef}[Costo globale di una soluzione]
  \[ C\pa{x} = \sum _{j\in A} l_j\pa{x_j}x_j \]  
\end{mydef}

\subsection{Instramento ottimo}
\label{sec:instramento-ottimo}

Data un'istanza $R$ ci chiediamo se esiste una soluzione che minimizza
il costo globale della soluzione.

\begin{mydef}[Instramento socialmente ottimo]
  Chiamiamo \textbf{instradamento socialmente ottimo} di $R$ una
  soluzione che minimizza la funzione costo $C$. 
\end{mydef}

Trovare un instradamento socialmente ottimo equivale a risolvere il
seguente problema di minimizzazione:
\begin{align*}
      \text{minimizzare}\;\; & \sum _{j\in A} x_j l_j(x_j) \\
      \text{tale che}\;\; &   x_p \ge 0 & \forall p\in P \\
      & x_j = \sum_{p\in P,p\ni j} x_p & \forall j\in A \\
      &\sum_{p\in P_i} x_p = X_i & \forall i\in W
\end{align*}

\begin{mypro}
  La regione di spazio definita dai vincoli della definizione di
  soluzione \`e un poliedro convesso e compatto
\end{mypro}
\begin{proof}
  I vincoli sono tutti lineari e descrivono insiemi chiusi, quindi la
  regione \`e un poliedro chiuso, se dimostriamo che \`e anche
  limitato abbiamo la tesi.

  Fissato $i\in W$, sappiamo che per ogni $p'\in P_i$ si ha $x_{p'} \ge
  0$, quindi fissato $p\in P$ si ha
  \[ X_i = \sum _{p'\in P_i} x_{p'} \Rightarrow x_p \le X_i \]
  quindi per ogni $p\in P_i$ vale $0\le x_p \le X_i$ e quindi le
  variabili $\bra{x_p}_{p\in P}$ sono limitate.

  Fissato $j\in A$ si ha:
  \[ x_j = \sum _{p\ni j} x_p \ge 0 \]
  \[ x_j = \sum _{p\ni j} x_p \le \sum _{p\in P} x_p = \sum _{i\in W}
    \sum _{p\in P_i} x_p = \sum _{i\in W} X_i \]
  quindi per ogni $j\in A$ vale $0\le x_j \le \sum _{i\in W} X_i$ e
  quindi le variabili $\bra{x_j}_{j\in A}$ sono limitate.
\end{proof}

\begin{myteo}[Esistenza dell'instradamento ottimo]
  Data un'instanza $R$ esiste sempre almeno un instradamento ottimo.
\end{myteo}
\begin{proof}
  La funzione costo \`e somma di prodotto di funzioni continue, quindi
  \`e continua. I vincoli di soluzione formano un insieme
  compatto. Per il teorema di Weierstrass la funzione ammette minimo.
\end{proof}
\begin{myoss}
  La soluzione socialmente ottima pu\`o non essere unica (vedi
  l'esempio di figura \ref{fig:esempio-so-nonunica}), ma il suo costo
  globale lo \`e.
\end{myoss}
\begin{figure}[ht]
  \centering
  \begin{tikzpicture}[mnode/.style={circle,fill=blue!20},>=latex]
    \node[mnode] (1) at (0,0) {s};
    \node[mnode] (2) at (2,0) {t};
    \draw [->] (1) to [bend left] node[above] {1} (2);
    \draw [->] (1) to [bend right] node[below] {1} (2);
    \draw [->,color=red] (-1,0) to node[above] {1} (1);
    \draw [->,color=red] (2) to (3,0);
  \end{tikzpicture}  
  \caption{Esempio di rete in cui ogni soluzione \`e ottima}
  \label{fig:esempio-so-nonunica}
\end{figure}

Chiamiamo (con un leggero abuso di notazione) $x^{SO}\pa{R}$ una
soluzione socialmente ottima di $R$. Nonostante questo vettore non sia
ben definito, \`e ben definita la quantit\`a $C\pa{x^{SO}\pa{R}}$.

\begin{myes}[Esempio di Pigou]
  \label{es:esempio-pigou}
  Vediamo l'esempio di Pigou in Figura \ref{fig:esempio-pigou}
  \begin{figure}[ht]
    \centering
    \begin{tikzpicture}[mnode/.style={circle,fill=blue!20,minimum size=0.65cm},>=latex,snode/.style={circle,fill=red!70}]
      \node[mnode] (1) at (0,0) {s}; 
      \node[mnode] (2) at (3,0) {t};
      \draw [->] (1) to [bend left] node[above] {$l_1(x) = x$} (2);
      \draw [->] (1) to [bend right] node[below] {$l_2(x) = 1$} (2);
      \draw [->,color=red] (-4,0) -- node[above] {1 unità di traffico} (1) ;
      \draw [->,color=red] (2) --  (5,0) ;
      \node at (7,0) {};
    \end{tikzpicture}
    \caption{Esempio di Pigou}
    \label{fig:esempio-pigou}
  \end{figure}
  Qui l'insieme dei percorsi coincide con l'insieme degl'archi, quindi
  possiamo usare solo un vettore di variabili $\bra{x_1, x_2}$.

  La funzione costo è: $C\pa{x} = x_1^2 + x_2$, aggiungendo la
  condizione $x_1 + x_2 = 1$ si ottiene
  \[ C\pa{x} = x_1 ^2 + 1 - x_1 \]
  il cui minimo si ottiene per
  \[ x^{SO}_1 = x^{SO}_2 = \frac{1}{2} \]
  abbiamo anche
  \[ C\pa{x^{SO}} = \frac{3}{4} \]

  Possiamo osservare che metà del traffico ha una latenza di
  $\frac{1}{2}$ mentre l'altra metà ha una latenza di $1$, quindi gli
  utenti stanno incontrando latenze diverse.
\end{myes}

\section{Instradamento di Wardrop}

\subsection{Motivazioni}
\label{sec:wardrop-motivazioni}

Vogliamo ora prevedere cosa succede quando gli utenti della nostra
rete decidono autonomamente quale percorso percorrere in modo da
massimizzare il proprio guadagno.

Abbiamo già osservato che nell'esempio di Pigou (esempio
\ref{es:esempio-pigou}) gli utenti incontreranno tempi di percorrenza
diversi, possiamo immaginare che in questo caso alcuni utenti
``furbi'' cercheranno di spostarsi sulla strada più veloce (anche al
costo di rallentarla) pur di ottenere un tempo di percorrenza minore.

Per descrivere come si comportano gli utenti quando cercano di
massimizzare il proprio guadagno (cioè quando diventano egoisti)
potremmo utilizzare la teoria dei giochi (vedi l'appendice
\ref{sec:teoria-giochi}) e, in particolare, cercare un equilibrio di
Nash di un qualche gioco costruito sulla rete.

Ricordiamo che un gioco è dato da
$\pa{\mathcal{I}, \pa{S_i}_{i\in\mathcal{I}},
  \pa{u_i}_{i\in\mathcal{I}}}$ dove $\mathcal{I}$ è l'insieme
\textbf{finito} dei giocatori.

Siccome abbiamo supposto il traffico infinitamente divisibile, non
possiamo costruire direttamente un gioco a partire dalla nostra rete,
abbiamo quindi tre strade:
\begin{enumerate}
\item definire direttamente un nuovo concetto di equilibrio su reti
  senza giustificarlo mediante la teoria dei giochi;
\item costruire \textbf{discretizzazioni} successive del traffico che
  approssimino il caso continuo, calcolare per ognuna di queste
  approssimazioni un equilibrio di Nash e farne un limite;
\item introdurre il concetto di \textbf{giochi non atomici} (ed il
  loro equilibrio di Nash) e applicare direttamente questa nuova
  teoria al nostro problema.
\end{enumerate}

Noi vedremo a grandi linee la seconda strada (discretizzare) ma senza
formalizzarla, poi nella sezione \ref{sec:wardrop-definizione} daremo
una definizione indipendente e formale (come previsto dal primo
metodo) di \textbf{equilibrio di Wardrop}.

L'idea è, quindi, di discretizzare il traffico in tante unità discrete
e omogenee e applicare un equilibrio di Nash. Supponiamo, per
semplicità, che tutto il traffico debba essere instradato tra un'unica
sorgente e un'unica destinazione.

\begin{myes}[Esempio di Pigou discretizzato]
  Riprendiamo l'esempio di Pigou (vedi figura \ref{fig:esempio-pigou})
  dove abbiamo discretizzato il traffico a due unità (che saranno i
  nostri giocatori).

  Traducendo l'istanza nel formalismo della teoria dei giochi
  otteniamo:
  \begin{align*}
    \mathcal{I} &= \set{1,2} & S_1 = S_2 & = \set{\text{Link 1},
                                           \text{Link 2}}
  \end{align*}
  \begin{table}[!ht]
    \centering
    \begin{tabular}{rcc}
      & Link $1$ & Link $2$ \\
      \cline{2-3}
      Link $1$ & \multicolumn{1}{|c|}{$-1,-1$} & \multicolumn{1}{|c|}{$-0.5,-1$}  \\
      \cline{2-3}
      Link $2$ & \multicolumn{1}{|c|}{$-1,-0.5$} & \multicolumn{1}{|c|}{$-1,-1$}  \\
      \cline{2-3}
    \end{tabular}
    \caption{Funzioni guadagno $(u_1,u_2)$, le righe rappresentano la
      scelta del primo giocatore, le colonne la scelta del secondo}
    \label{tab:pigou-nash}
  \end{table}

  Si vede facilmente che per entrambi i giocatori scegliere
  \textit{Link 1} è una strategia dominante, quindi diciamo che la
  nuova soluzione è:
  \begin{align*}
    x^{N}_1 &= 1 & x^{N}_2 &= 0
  \end{align*}
  con un costo globale $C\pa{x^{N}} = 1$.
\end{myes}

Data un'instanza $R$ e una sua discretizzazione $R_n$, avremo
l'insieme dei giocatori $\mathcal{I} = \set{1,...,n}$ rappresentante
le singole unità di traffico con peso $m$, per ogni giocatore
l'insieme delle strategie disponibili è l'insieme $P$ dei percorsi e
le funzioni guadagno saranno
\[ u_i \pa{s} = u_i\pa{s_i, s_{-i}} = - \sum _{j\in s_i}
  l_j\pa{\sum_{s_k\ni j} m} = -\sum _{j\in s_i} l_j\pa{m + \sum_{s_k\ni
      j,k\neq i} m} \]
con $s = \bra{s_i}_{i\in\mathcal{I}} \in P^n$

Possiamo anche scrivere, per semplicità:
\[ u_i\pa{s_i, s_{-i}} = - \sum _{j\in s_i} l_j\pa{x_j\pa{s_i, s_{-i}}} \]
dove
\[ x_j\pa{s_i,s_{-i}} = \sum_{s_k\ni j} m = \left\{ 
    \begin{matrix}
      m + \sum_{s_k\ni j,k\neq i} m & \text{ se } j\in s_i \\
      \sum_{s_k\ni j,k\neq i} m & \text{ se } j\not\in s_i
    \end{matrix}
  \right.
\]

Dalla definizione, $s^*$ è un \textbf{equilibrio di Nash} per $R_n$ se
e solo se per ogni $i\in \mathcal{I}$ vale
\[ \forall p\in P \;\; u_i \pa{p,s^*_{-i}} \le u_i\pa{s^*_i,s^*_{-i}} \]

Per $n \to \infty$ avremo che $m\to 0$ e quindi
\[ x_j\pa{p, s^*_{-i}} \approx x_j\pa{s^*_i, s^*_{-i}} \]
cioè la scelta di un singolo giocatore al limite non influenza il
flusso di ogni arco. Ricordando che le funzioni $l_j$ sono continue si
ottiene che
$l_j\pa{x_j\pa{p, s^*_{-i}}} \approx l_j\pa{x_j\pa{s^*_i, s^*_{-i}}}$
da cui:
\[ u_i\pa{p, s^*_{-i}} \approx - \sum_{j\in p} l_j\pa{x_j\pa{s^*_i,
      s^*_{-i}}} = -\sum _{j\in p}l_j\pa{x^*_j} \]

La condizione dell'equilibrio di Nash si può quindi riscrivere come:
\[ \forall p\in P\;\;\; \sum _{j\in s_i}l_j\pa{x^*_j} \le \sum _{j\in
    p}l_j\pa{x^*_j} \]
osservando che $x_p > 0 \Leftrightarrow \exists i\in \mathcal{I}:\;
s^*_i = p$ otteniamo che al limite
\[ \forall x_p >0, \forall p'\in P \;\;\; \sum _{j\in p}l_j\pa{x^*_j}
  \le \sum _{j\in p'}l_j\pa{x^*_j} \]
cioè i percorsi scelti sono quelli che minimizzano il tempo di
percorrenza, inoltre se anche $x_{p'} > 0$ la relazione vale con il
segno di uguaglianza (basta scambiare il ruolo delle variabili).

Questo ci porta al primo criterio proposto da
Wardrop\cite[pag. 345]{wardrop1952} per determinare la distribuzione
del traffico: \textit{Il tempo di percorrenza di tutte le strade
  veramente usate è uguale e più piccolo di quello che impiegherebbe
  un singolo veicolo a percorrere una strada non utilizzata}

Il ragionamento che abbiamo seguito, oltre a non essere ben
formalizzato, non tiene in considerazione il problema che l'equilibrio
di Nash potrebbe non esistere per ogni $n$ e quando esiste potrebbe
non essere unico. Inoltre non abbiamo gestito in alcun modo il
passaggio al limite che potrebbe non sempre essere fattibile.

In alcuni casi è possibile formalizzare questo ragionamento ottenendo,
ad esempio, il seguente teorema:
\begin{myteo}[{\cite[Teorema 3.2]{haurie1985}}]
  Sia $R\in \mathcal{R}$ un'istanza e $\pa{R_n}_{n\in \mathbb{N}}$ una
  successione di approssimazioni discrete di $R$, se per ogni $n$
  esiste un equilibrio di Nash per $R_n$ e se le funzioni costo $l_j$
  sono strettamente crescenti, allora esiste un'unica soluzione $x$
  che rispetta il criterio di Wardrop e tale che per ogni sequenza
  $x_n$ di soluzioni associate ad un equilibrio di Nash si ha
  \[ \lim _{n\to \infty} x_n = x^* \]
\end{myteo}

\subsection{Definizione e esistenza}
\label{sec:wardrop-definizione}

Formalizziamo il principio di Wardrop nel caso generale, applicando il
principio di Wardrop ad ogni coppia sorgente-destinazione otteniamo la
seguente definizione:
\begin{mydef}[Equilibrio di Wardrop]
  Una soluzione $x$ di $R\in \mathcal{R}$ è un \textbf{equilibrio di
    Wardrop} se per ogni coppia di sorgente-destinazione $(s_i,t_i)$
  (cioè per ogni $i\in W$) vale:
  \begin{align*}
    \sum _{j\in p'} l_j(x_j) &= \sum _{j\in p} l_j(x_j) & \forall
                                                           p,p'\in P_i \text{ con } x_p >0, x_{p'} >0 \\
    \sum _{j\in p'} l_j(x_j) &\ge \sum _{j\in p} l_j(x_j) & \forall
                                                             p,p'\in P_i \text{ con } x_p >0, x_{p'} =0 
  \end{align*}
  indichiamo con $x^{WE}(R)$ una tale soluzione.
\end{mydef}

Osserviamo che due coppie sorgente-destinazione differenti potrebbero
avere tempi di percorrenza diversi.

Vediamo ora alcuni teoremi che ci assicurano l'esistenza di un
equilibrio di Wardrop. Come nel caso della soluzione socialmente
ottima questo equilibrio non sarà in generale unico (quindi la
notazione $x^{WE}(R)$ non sarebbe ben definita), ma il costo di tale
soluzione lo sarà (e quindi la quantità $C\pa{x^{WE}\pa{R}}$ sarà ben
definita).

\begin{myteo}[Beckmann, McGuire and Winsten]
  Data un'istanza $R\in \mathcal{R}$, una soluzione $x$ è un equilibrio di
  Wardrop per $R$ se e solo se $x$ è un punto di minimo del problema
  \begin{align*}
    \text{minimizzare} \;&  \sum _{j\in A} \int _0 ^ {x_j}
                           l_j(z)\de z \\
    \text{con} \;& \sum _{p\in P, p\ni j} x_p = x_j&\forall j\in
                                                     A\\
                         & \sum _{p\in P_i} x_p = X_i& \forall i\in W\\
                         & x_p \ge 0&\forall p\in P        
  \end{align*}
\end{myteo}
\begin{proof}
  Scriviamo le funzioni:
  \begin{align*}
    f(x) &= \sum _{j\in A} \int _0 ^ {x_j} l_j(z)\de z \\
    g_p(x) &= -x_p & \forall p\in P \\
    h_j(x) &= \sum _{p\ni j} x_p -x_j & \forall j\in A\\
    t_i(x) &= \sum _{p\in P_i} x_p - X_i & \forall i\in W
  \end{align*}
  
  Il problema diventa
  \begin{align*}
    \text{minimizzare} \;&  f(x) \\
    \text{con} \;& g_p(x) \le 0 &\forall p \in P \\
                         & h_j(x) = 0 & \forall j\in A\\
                         & t_i(x) = 0 & \forall i\in W
  \end{align*}

  Abbiamo supposto all'inizio le $l_j$ continue, non negative e non
  decrescenti, quindi $f$ è una funzione convessa. Inoltre i vincoli
  sono tutti lineari, quindi (per un teorema visto a lezione) $x$ è
  punto di minimo se e solo se valgono le condizioni di
  Karush–Kuhn–Tucker in $x$.

  Le KKT in $x$ si scrivono come $\exists \lambda \in \mathbb{R}_+^{\abs{P}}$,
  $\exists \mu \in \mathbb{R}^{\abs{A}}$,
  $\exists \theta \in \mathbb{R}^{\abs{W}}$ tali che:
  \[ 0 = \nabla f(x) + \sum_{p\in P}\lambda _p \nabla g_p(x) + \sum _{j\in
      A} \mu _j \nabla h_j(x) + \sum _{i\in W} \theta _i \nabla t_i(x) \]
  \[ \forall p\in P\;\; \lambda _p g_p(x) = 0 \]
  
  Scrivendo le condizioni componente per componente otteniamo:
  \begin{align*}
    l_j(x_j) - \mu _j =0 && \forall j\in A \\
    -\lambda _p + \sum _{j\in p}\mu _j + \theta _i =0 && \forall p \in
                                                      P _i \\
    \lambda _p x_p =0 && \forall p\in P
  \end{align*}
  la condizione di complementarità può essere riscritta come $x_p > 0
  \rightarrow \lambda _p =0$, le altre come:
  \begin{align*}
    l_j(x_j) = \mu _j && \forall j\in A \\
    \sum _{j\in p}l_j(x_j) = -\theta _i + \lambda _p && \forall p \in
                                                      P _i
  \end{align*}
  dalla seconda utilizzando la complementarietà degli scarti si
  ottiene:
  \begin{align*}
    \forall p\in P_i,\;\; x_p > 0 & \Rightarrow \sum _{p\ni j} l_j(x_j) = -\theta _i \\
    \forall p\in P_i,\;\; x_p = 0 & \Rightarrow \sum _{p\ni j} l_j(x_j) \ge -\theta _i
  \end{align*}
  queste sono proprio le condizioni di Wardrop dove la quantità
  $-\theta _i$ rappresenta proprio la minima lunghezza effettiva di un
  percorso tra $s_i$ e $t_i$.
\end{proof}
\begin{mycor}
  Data un'istanza $R\in \mathcal{R}$ esiste sempre un equilibrio di
  Wardrop per $R$, inoltre se tutte le funzioni costo di $R$ sono
  strettamente crescenti allora tale equilibrio è unico.
\end{mycor}
\begin{proof}
  Per il teorema precedente il probelema dell'equilibrio di Wardrop è
  equivalente ad un problema di minimizzazione convessa (dove
  l'insieme definito dai vincoli è compatto), quindi esiste sempre una
  soluzione.

  Nel caso in cui le funzioni costo siano strettamente crescenti la
  funzione obiettivo del problema equivalente è strettamente convessa
  e quindi la soluzione sarà unica.
\end{proof}

\begin{myteo}
  Il costo globale dell'equilibrio di Wardrop è unico, quindi è ben
  definita la quantità $C\pa{x^{WE}\pa{R}}$.
\end{myteo}
\begin{proof}
  Abbiamo visto che $x$ è un equilibrio di Wardrop se e solo se è
  minimo (vincolato) della funzione $f(x) = \sum _{j\in A} \int _0
  ^{x_j} l_j(z)\de z$, abbiamo anche visto che la funzione $f$ è
  convessa.

  Sia $L_j(x_j) = \int _0 ^{x_j} l_j(z)\de z$, queste sono tutte
  funzioni convesse per le ipotesi sulle funzioni $l_j$.

  Siano $x,y$ due punti di minimo vincolati di $f$, per la convessità
  sappiamo che per ogni $t\in\bra{0,1}$ si ha
  \[ f\pa{ tx + (1-t)y} \le tf(x) + (1-t)f(y) \]
  ma in realtà questa relazione vale con l'uguaglianza perché
  $f(x)=f(y)$ è il valore minimo di $f$.

  Ricordando che anche le $L_j$ sono convesse, quindi possiamo
  scrivere:
  \begin{align*}
    f\pa{ tx + (1-t)y} & = \sum _{j\in A} L_j\pa{tx_j + (1-t)y_j} \\
    & \le \sum _{j\in A} \pa{ tL_j(x_j) + (1-t)L_j(y_j)} \\
    & = t \sum _{j\in A} L_j(x_j) + (1-t)\sum _{j\in A} L_j(y_j) \\
    & = tf(x) + (1-t)f(y)
  \end{align*}
  ricordando l'equazione precedente si può dedurre che per ogni $j\in
  A$ si ha
  \[ L_j\pa{tx_j + (1-t)y_j} = tL_j(x_j) + (1-t)L_j(y_j) \]
  quindi le $L_j$ sono lineari in $\bra{x_j,y_j}$, ma questo accade se
  e solo se le $l_j$ sono costanti negli stessi intervalli.

  Quindi per ogni $j\in A$ abbiamo $l_j(x) = l_j(y)$ e quindi $C(x) = C(y)$.  
\end{proof}

\begin{myes}[Esempio di Pigou]
  Applicando l'equilibrio di Wardrop all'esempio di Pigou (vedi
  esempio \ref{es:esempio-pigou}) si ottiene la soluzione:
  \begin{align*}
    x^{WE}_1 &= 1 & x^{WE}_2 &= 0 & C\pa{x^{WE}} &= 1
  \end{align*}
  che coincide con la soluzione calcolata dall'equilibrio di Nash nel
  caso discretizzato.

  Osserviamo, infine, che il costo globale della soluzione $x^{WE}$ è
  maggiore del costo della soluzione socialmente ottima.
\end{myes}

\subsection{Inefficienza dell'equilibrio di Wardrop}
\label{sec:wardrop-inefficienza}

\subsubsection{Prezzo dell'anarchia}
\label{sec:wardrop-poa}

Abbiamo già visto nell'esempio di Pigou che il costo globale della
soluzione di Wardrop può essere maggiore del costo della soluzione
ottima, siamo quindi interessati a studiare la quantità
\[ \frac{C\pa{x^{SO}\pa{R}}}{C\pa{x^{WE}\pa{R}}} \]
al variare di $R$ in opportuni sottoinsiemi di $\mathcal{R}$. Lo
studio di questa quantità, in particolare del suo minimo, ci dirà di
quanto l'equilibrio di Wardrop può peggiorare il costo rispetto alla
soluzione ottima.

\begin{myteo}[Roughgarden e Tardos{\cite[Teorema
    4.5]{roughgarden2002}}]
\label{teo:roughgarden-tardos}
  \[ \inf _{R\in \mathcal{R}^{conv}} \frac{C\pa{ x^{SO}\pa{R}}}{C\pa{
        x^{WE}\pa{R}}} = 0 \]
  \[ \inf _{R\in \mathcal{R}^{aff}} \frac{C\pa{ x^{SO}\pa{R}}}{C\pa{
        x^{WE}\pa{R}}} = \frac{3}{4} \]
\end{myteo}

È possibile dimostrare anche una versione più forte del secondo punto
\begin{myteo}[{\cite[Lemma 3.10]{menache2011network}}]
\label{teo:poa-we-conc}
  \[ \inf _{R\in \mathcal{R}^{conc}} \frac{C\pa{ x^{SO}\pa{R}}}{C\pa{
        x^{WE}\pa{R}}} = \frac{3}{4} \]
\end{myteo}

Non dimostraiamo quest'ultimo teorema (una dimostrazione si può
trovare nel testo citato) e dimostriamo solo la prima
parte del teorema di Roughgarden e Tardos (la seconda è un corollario
del teorema \ref{teo:poa-we-conc}).

\begin{proof}[Dimostrazione della prima parte del teorema \ref{teo:roughgarden-tardos}]
  Per dimostrare questa parte del teorema ci basta esibire una
  successioni di istanze $\pa{R_k}_{k\in \mathbb{N}}$ tali che $R_k\in
  \mathcal{R}^{conv}$ e
  \[ \lim _{k\to \infty} \frac{C\pa{ x^{SO}\pa{R_k}}}{C\pa{
x^{WE}\pa{R_k}}} = 0 \]

  \begin{figure}[ht]
    \centering
    \begin{tikzpicture}[mnode/.style={circle,fill=blue!20,minimum size=0.65cm},>=latex,snode/.style={circle,fill=red!70}]
      \node[mnode] (1) at (0,0) {s}; 
      \node[mnode] (2) at (3,0) {t};
      \draw [->] (1) to [bend left] node[above] {$l_1(x_1) = x_1^k$} (2);
      \draw [->] (1) to [bend right] node[below] {$l_2(x_2) = 1$} (2);
      \draw [->,color=red] (-1,0) -- node[above] {1} (1) ;
      \draw [->,color=red] (2) --  (4,0) ;
    \end{tikzpicture}
    \caption{Istanza $R_k$}
    \label{fig:esempio-conv-poa}
  \end{figure}

  Sia $R_k$ l'istanza costituita come in figura
  \ref{fig:esempio-conv-poa} (differisce dall'esempio di Pigou per la
  funzione $l_1$), come abbiamo già osservato precendentemente ci
  bastano le variabili $x_1$ e $x_2$ (rispettivamente il traffico sul
  primo e sul secondo arco) per descrivere l'instradamento (l'insieme
  degli archi coincide con l'insieme dei percorsi).
  
  I vincoli sono:
  \begin{align*}
    x_1 &\ge 0 & x_2 &\ge 0 & x_1 + x_2 &= 1
  \end{align*}
  le funzioni da minimizzare
  \begin{align*}
    f^{SO}(x) &= x_1^{k+1} + x_2 & f^{WE}(x) &= \frac{x_1^{k+1}}{k+1}
                                              + x_2
  \end{align*}
  
  Senza dover minimizzare $f^{WE}$ si può vedere che nell'equilibrio
  di Wardrop tutto il traffico viene instradato nel primo link,
  infatti in qualunque soluzione con $x_2>0$ si avrebbe $x_1<1$ da cui
  $l_1(x_1) < 1 = l_2(x_2)$ e quindi non potrebbe essere un equilibrio
  di Wardrop. Quindi:
  \begin{align*}
    x^{WE}_1 &= 1 & x^{WE}_2 &= 0 & C\pa{x^{WE}} = 1
  \end{align*}

  Riscrivendo $f^{SO}$ eliminando $x_2$ (con il terzo vincolo) si ha
  \[ f^{SO}(x) = x_1^{k+1} - x_1 + 1 \]
  questa funzione per $x_1\ge 0$ ha un unico punto di minimo in $x_1 =
  \pa{k+1}^{-1/k}$, la soluzione corrispondente rispetta i vincoli e
  quindi è la soluzione cercata
  \begin{align*}
    x^{SO}_1 &= \pa{k+1}^{-1/k} & x^{SO}_2 &= 1- \pa{k+1}^{-1/k} &
    C\pa{x^{SO}} &= 1 - \frac{k}{k+1}\pa{k+1}^{-1/k} 
  \end{align*}
  
  Calcolando il limite si vede che la successione si comporta come
  richiesto:
  \[ \lim _{k\to \infty} \frac{C\pa{ x^{SO}\pa{R_k}}}{C\pa{
        x^{WE}\pa{R_k}}} = 1 - \lim _{k\to \infty}
    \frac{k}{k+1}\pa{k+1}^{-1/k} = 0 \]
\end{proof}

\subsubsection{Paradosso di Braess}
\label{sec:paradosso-braess}

Un altro comportamento inefficiente dell'equilibrio di Wardrop è dato
dall'esempio del paradosso di Braess

\begin{myes}[Paradosso di Braess{\cite[pag. 263]{braess1968}}]
\label{es:braess}
  Consideriamo un'istanza come in figura \ref{fig:braess-prima}, qui
  la disposizione del traffico secondo l'equilibrio di Wardrop
  coinciderà con la disposizione della soluzione socialmente
  ottima. Il costo globale di entrambe le soluzioni sarà $3/2$.
  \begin{figure}[ht]
    \centering
    \begin{tikzpicture}[mnode/.style={circle,fill=blue!20,minimum size=0.65cm},>=latex,snode/.style={circle,fill=red!70}]
      \node[mnode] (0) at (0,0) {0}; 
      \node[mnode] (1) at (3,2) {1};
      \node[mnode] (2) at (3,-2) {2};
      \node[mnode] (3) at (7,0) {3};
      \draw [->] (0) to node[below] {x} (1);
      \draw [->] (0) to node[above] {1} (2);
      \draw [->] (1) to node[below] {1} (3);
      \draw [->] (2) to node[above] {x} (3);
      \draw [->,color=red] (-1,0) -- node[above,color=black] {1} (0) ;
      \draw [->,color=red] (0) to [bend left] node[above,color=red]{$1/2$} (1);
      \draw [->,color=red] (0) to [bend right] node[below,color=red]{$1/2$} (2);
      \draw [->,color=red] (1) to [bend left] node[above,color=red]{$1/2$} (3);
      \draw [->,color=red] (2) to [bend right] node[below,color=red]{$1/2$} (3);
      \draw [->,color=red] (3) -- (8,0) ;
    \end{tikzpicture}
    \caption{Paradosso di Braess: prima di aggiungere la nuova strada}
    \label{fig:braess-prima}
  \end{figure}

  Supponiamo ora di voler ``migliorare'' la rete aggiungendo un nuovo
  arco tra il nodo 1 e il nodo 2 con costo $0$ (vedi figura
  \ref{fig:braess-dopo}). Potremmo pensare che, essendo un
  miglioramento, il costo del nuovo equilibrio debba essere minore o
  uguale a quello del vecchio equilibrio.

  \begin{figure}[ht]
    \centering
    \begin{tikzpicture}[mnode/.style={circle,fill=blue!20,minimum size=0.65cm},>=latex,snode/.style={circle,fill=red!70}]
      \node[mnode] (0) at (0,0) {0}; 
      \node[mnode] (1) at (3,2) {1};
      \node[mnode] (2) at (3,-2) {2};
      \node[mnode] (3) at (7,0) {3};
      \draw [->] (0) to node[below] {x} (1);
      \draw [->] (0) to node[above] {1} (2);
      \draw [->] (1) to node[below] {1} (3);
      \draw [->] (2) to node[above] {x} (3);
      \draw [->,color=red] (-1,0) -- node[above,color=black] {1} (0) ;
      \draw [->,color=white] (0) to [bend left] node[below,color=blue]{$1/2$} (1);
      \draw [->,color=white] (0) to [bend right] node[above,color=blue]{$1/2$} (2);
      \draw [->,color=white] (1) to [bend left] node[below,color=blue]{$1/2$} (3);
      \draw [->,color=white] (2) to [bend right] node[above,color=blue]{$1/2$} (3);
      \draw [->] (1) to node[left] {0} (2);
      \draw [->,color=red,line width=1.5pt] (1) to [bend left] node[right,color=red]
      {1} (2);
      \draw [->,color=red,line width=1.5pt] (0) to [bend left] node[above]{$1$} (1);
      \draw [->,color=red,line width=1.5pt] (2) to [bend right] node[below]{$1$} (3);
      \draw [->,color=red,line width=1.5pt] (-1,0) -- (0) ;
      \draw [->,color=red,line width=1.5pt] (3) -- (8,0) ;
    \end{tikzpicture}

    \caption{Paradosso di Braess: dopo aver aggiunto la nuova strada,
      in rosso il traffico dell'equilibrio di Wardrop, in blu quello
      della soluzione ottima}
    \label{fig:braess-dopo}
  \end{figure}

  In effetti la soluzione ottima non è modificata (quindi il costo non
  peggiora), ma calcolando l'equilibrio di Wardrop si vede che tutto
  il traffico segue il percorso 0 -- 1 -- 2 -- 3 e il costo globale
  diventa $2$.
\end{myes}

Come abbiamo visto nell'esempio, migliorare la qualità dei
collegamenti di una rete potrebbe peggiorare il costo incontrato dagli
utenti. Vogliamo definire in modo più formale questa situazione, per
farlo ci serve prima la definizione di sottorete.

\begin{mydef}[Sottorete]
\label{def:sottorete}
  Data un'istanza $R=(V,A,P,s,t,X,l)$ diciamo che
  $R_0=(V_0,A_0,P_0,s_0,t_0)$ è una \textbf{sottorete} di $R$ se:
  \begin{enumerate}
  \item $V_0 \subseteq V$ e $A_0 = A \cap \pa{V_0\times V_0}$,
  \item esistono due nodi $s_0,t_0\in V$ tali che tutti i percorsi di
    $P$ passanti per $\pa{V_0,A_0}$ contengono un percorso in $P_0$ da
    $s_0$ in $t_0$ sugl'archi di $A_0$.
  \end{enumerate}
  Scriviamo $R_0\subseteq R$.
\end{mydef}

Osserviamo che la seconda richiesta della definizione fa sì che la
rete abbia un unico punto di accesso e un unico punti di uscita,
questo significa che ogni percorso passante per gli archi di $R_0$
deve entrare in $R_0$ attraverso $s_0$ e uscire tramite $t_0$. Ci
stiamo quindi restringendo a sottoreti \textbf{con un unico punto di
  ingresso e un unico punto di uscita}.

\begin{figure}[ht]
  \centering
      \begin{tikzpicture}[mnode/.style={circle,fill=blue!20,minimum size=0.65cm},>=latex,snode/.style={circle,fill=red!70},rnode/.style={circle,fill=green!50,minimum size=0.65cm}]
      \node[mnode] (0) at (0,0) {$s$};
      \node[mnode] (1) at (2,0) {};
      \node[mnode] (2) at (3.7,-1) {};
      \node[mnode] (3) at (6,0) {$t$};
      \node[rnode] (4) at (2,-2) {$s_0$};
      \node[rnode] (5) at (5,-2) {$t_0$};
      \node[rnode] (6) at (3,-3) {};
      \node[rnode] (7) at (4,-3) {};
      \draw [->] (0) to (1);
      \draw [->] (1) to (2);
      \draw [->] (2) to (3);
      \draw [->] (1) to (3);
      \draw [->] (0) to (4);
      \draw [->] (2) to (3);
      \draw [->] (1) to (4);
      \draw [->] (5) to (3);
      \draw [->] (4) to (2);
      \draw [->] (2) to (5);
      \draw [->,color=green] (4) to (5);
      \draw [->,color=green] (4) to (6);
      \draw [->,color=green] (6) to (7);
      \draw [->,color=green] (7) to (5);
      \draw [->,color=green] (6) to (5);
      \draw [->,color=red] (-1,0) -- (0) ;
      \draw [->,color=red] (3) -- (7,0) ;
    \end{tikzpicture}
  \caption{Esempio di sottorete: i nodi e gli archi verdi
    rappresentano la sottorete.}
  \label{fig:sottorete}
\end{figure}

Siamo ora pronti a definire cos'è un paradosso di Braess.
\begin{mydef}[Paradosso di Braess]
  Data una rete $R=(V,A,P,s,t,X,l)$ e una sua sottorete
  $R_0=(V_0,A_0,P_0,s_0,t_0)$ diciamo che esiste un
  \textbf{paradosso di Braess} in $R$ centrato in $R_0$ se esiste
  un'altra istanza nella forma $R_m=(V,A,P,s,t,X,m)$ tale che:
  \begin{enumerate}
    \begin{minipage}{1.0\linewidth}
    \item $\forall j\in A$ e $\forall x_j \ge0$
      \begin{itemize}
      \item $j \in A_0 \longrightarrow m_j(x_j) \le l_j(x_j)$,
      \item $j \not\in A_0\longrightarrow m_j(x_j) = l_j(x_j)$;
      \end{itemize}
    \end{minipage}
  \item $C\pa{x^{WE}\pa{R_m}} > C\pa{x^{WE}\pa{R}}$.
  \end{enumerate}
\end{mydef}

Nell'esempio \ref{es:braess} la sottorete in cui esiste il paradosso è
l'arco $1 -- 2$ che inizialemente ha costo $+\infty$ e poi viene
migliorato facendolo passare a $0$.

\section{Instradamento parzialmente ottimo}

\subsection{Modello e soluzione}
\label{sec:por-modello}

Vogliamo analizzare ora reti in cui alcune porzioni sono gestite da
degli operatori che controllano completamente il traffico al loro
interno.

Data un'istanza $R\in \mathcal{R}$ supponiamo che ci siano $k$
sottoreti \textbf{disgiunte} $R_1,...,R_k \subseteq R$ controllate da
diversi operatori. Ricordiamo che nella definizione
\ref{def:sottorete} (sottorete) abbiamo supposto che ogni sottorete
abbia un unico punto di ingresso e un unico punto di uscita.

Per semplicità supponiamo che ci sia un unico operatore e, quindi,
un'unica sottorete $R_0 \subseteq R$.

Nella souluzione che vogliamo definire l'operatore, avendo il pieno
controllo della sua sottorete, instraderà in modo ottimo il traffico
che lo attraversa, il resto della rete continuerà ad utilizzare
l'equilibrio di Wardrop.

Data $R=(V,A,P,s,t,X,l)$ e $R\supseteq R_0 =(V_0,A_0,P_0,s_0,t_0)$
consideriamo, al variare di $X_0\in \mathbb{R}^+$, la rete
\[ R_0\pa{X_0} = \pa{V_0,A_0,P_0,\bra{s_0},\bra{t_0},\bra{X_0},
    l_{\mid A_0}} \]
si ha che $R_0\pa{X_0}\in \mathcal{R}$, quindi possiamo calcolarne una
soluzione socialmente ottima e definire (per $X_0>0$) la quantità
\[ L_0\pa{X_0} = C\pa{x^{SO}\pa{R_0\pa{X_0}}} \]
\begin{mydef}[Latenza effettiva]
  Chiamiamo \textbf{latenza effettiva} di $R_0 \subseteq R$ la
  funzione
  \[ l_0\pa{X_0} = \left\{
      \begin{matrix}
        \frac{L\pa{X_0}}{X_0} & \text{ per } X_0 > 0 \\
        \lim _{x\to 0} l_0\pa{x_0} & \text{ per } X_0 = 0
      \end{matrix}
    \right. \]
\end{mydef}
\begin{mylem}
\label{lem:l0-regolare}
  La funzione $l_0$ così definita è continua, non negativa e non
  decrescente.
\end{mylem}
\begin{proof}
  Dimostriamo la proprietà su $\pa{0,+\infty}$.

  La funzione costo globale $C$ è somma di termini del tipo $x_j
  l_j(x_j)$ che sono non negativi per definizione di soluzione e di
  istanza, quindi la funzione $L_0$ è non negativa e di conseguenza è
  non negativa la funzione $l_0$.

  Osservo che la funzione $C$ ha la seguente proprietà per ogni $x$
  soluzione e per ogni $\lambda \le 1$:
  \[ C\pa{\lambda x} = \sum _{j\in A} \lambda x_j l_j\pa{\lambda x_j}
    = \lambda \sum _{j\in A} l_j\pa{\lambda x_j} \le \lambda \sum
    _{j\in A} l_j\pa{\lambda x_j} = \lambda C\pa{x} \]

  Siano $a,b\in \pa{0,+\infty}$ tali che $a<b$ e siano $x^a$ e $x^b$
  delle soluzioni socialmente ottime rispettivamente di $R_0\pa{a}$ e
  $R_0\pa{b}$. Considero ora il vettore
  \[ \frac{a}{b} x^b \le x^b \]
  (dove le operazioni e i confronti vanno intese componente per
  componente), si vede facilmente che questo vettore è una soluzione
  di $R_0(a)$, in generale non sarà una soluzione socialmente ottima.

  Si ha:
  \[ L_0\pa{a} = C\pa{x^a} \le C\pa{\frac{a}{b} x^b} \le \frac{a}{b}
    C\pa{x^b} = \frac{a}{b}L_0\pa{b} \]
  quindi:
  \[ l_0(a) = \frac{L_0(a)}{a} \le \frac{\frac{a}{b} L_0(b)}{a}
    =\frac{L_0(b)}{b} = l_0(b) \]
  
  Data la non decrescenza, per dimostrare la continuità ci basta
  dimostrare che per ogni $\bar X\in \pa{0,\infty}$ vale
  $\lim _{X\to \bar X^+} l_0\pa{X} \le l_0\pa{\bar X}$ che equivale a
  \[ \lim _{\lambda \to 1^+} L_0\pa{\lambda \bar X} \le
    L_0\pa{\bar X} \] chiamiamo $\bar x$ una soluzione socialmente
  ottima di $R_0\pa{\bar X}$.
  
  Per $\lambda > 1$ il vettore $\lambda \bar x$ è una soluzione (non
  necessariamente ottima) di $R\pa{\lambda \bar X}$, quindi
  \[ L_0\pa{\lambda \bar X} \le C\pa{\lambda \bar x} = \sum _{j\in A}
    \lambda \bar x_j l_j(\lambda \bar x_j) \]
  passando al limite e ricordando che le funzioni $l_j$ sono continue
  si ottiene:
  \[ \lim _{\lambda \to 1^+} L_0\pa{\lambda \bar X} \le \lim _{\lambda
      \to 1^+} \sum _{j\in A}\lambda \bar x_j l_j\pa{\lambda \bar x_j}
    = \sum _{j\in A} \bar x_j l_j\pa{\bar x_j} = C\pa{\bar x} =
    L_0\pa{\bar X} \]

  Abbiamo dimostrato le proprietà su $\pa{0,+\infty}$, il limite per
  $X_0 \to 0$ è ben definito per la non decrescenza. La continuità e
  la non negatività sono ovvie per la definizione di $l_0\pa{0}$.
\end{proof}

\begin{mylem}
  Sia $R\in \mathcal{R}^{aff}$ è un'istanza e $R_0\subseteq R$ una
  sottorete, allora la funzione $l_0$ è concava.
\end{mylem}
\begin{proof}
  TODO: \cite[Lemma 3.11]{menache2011network}
\end{proof}



\section{Instradamento in presenza di costi fissati dai gestori della rete}

\appendix

\section{Teoria dei giochi}
\label{sec:teoria-giochi}

\cite{menache2011network}

\bibliographystyle{alpha}

\bibliography{menache2011network,wardrop1952,haurie1985,roughgarden2002,braess1968}

\end{document}