\documentclass{beamer}

\usetheme{metropolis}

\metroset{sectionpage=none,progressbar=frametitle,subsectionpage=progressbar}
\metroset{numbering=fraction}
\metroset{block=fill}

%\usepackage{pgfpages}
%\setbeameroption{show notes on second screen}

\usepackage{appendixnumberbeamer}

\usepackage[utf8x]{inputenc}
\usepackage[italian]{babel}

\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsthm}
\usepackage{xfrac}
\usepackage{mathtools}
\usepackage{graphicx}
\usepackage{hyperref}
\usepackage{mathtools}
\usepackage{xcolor}

\usepackage{tikz}
\usetikzlibrary{arrows}

% to do small font tabular columns
%\usepackage{array}


\newcounter{counter1}

\theoremstyle{plain}
\newtheorem{myteo}[counter1]{Teorema}
\newtheorem{mylem}[counter1]{Lemma}
\newtheorem{mypro}[counter1]{Proposizione}
\newtheorem{mycor}[counter1]{Corollario}
%\newtheorem*{myteo*}{Teorema}
%\newtheorem*{mylem*}{Lemma}
%\newtheorem*{mypro*}{Proposizione}
%\newtheorem*{mycor*}{Corollario}

\theoremstyle{definition}
\newtheorem{mydef}[counter1]{Definizione}
\newtheorem{myes}[counter1]{Esempio}
%\newtheorem{myex}[counter1]{Esercizio}
%\newtheorem*{mydef*}{Definizione}
%\newtheorem*{myes*}{Esempio}
%\newtheorem*{myex*}{Esercizio}

\theoremstyle{remark}
%\newtheorem{mynot}[counter1]{Nota}
\newtheorem{myoss}[counter1]{Osservazione}
%\newtheorem*{mynot*}{Nota}
%\newtheorem*{myoss*}{Osservazione}

\newcommand{\obar}[1]{\overline{#1}}
\newcommand{\ubar}[1]{\underline{#1}}

\newcommand{\set}[1]{\left\{#1\right\}}
\newcommand{\pa}[1]{\left(#1\right)}
\newcommand{\ang}[1]{\left<#1\right>}
\newcommand{\bra}[1]{\left[#1\right]}
\newcommand{\abs}[1]{\left|#1\right|}
\newcommand{\norm}[1]{\left\|#1\right\|}
\newcommand{\ceil}[1]{\left\lceil#1\right\rceil}
\newcommand{\floor}[1]{\left\lfloor#1\right\rfloor}

\newcommand{\pfrac}[2]{\pa{\frac{#1}{#2}}}
\newcommand{\bfrac}[2]{\bra{\frac{#1}{#2}}}
\newcommand{\psfrac}[2]{\pa{\sfrac{#1}{#2}}}
\newcommand{\bsfrac}[2]{\bra{\sfrac{#1}{#2}}}

\newcommand{\der}[2]{\frac{\partial #1}{\partial #2}}
\newcommand{\pder}[2]{\pfrac{\partial #1}{\partial #2}}
\newcommand{\sder}[2]{\sfrac{\partial #1}{\partial #2}}
\newcommand{\psder}[2]{\psfrac{\partial #1}{\partial #2}}

\newcommand{\intl}{\int \limits}

\DeclareMathOperator{\de}{d}
\DeclareMathOperator{\id}{Id}
\DeclareMathOperator{\len}{len}

\DeclareMathOperator{\gl}{GL}
\DeclareMathOperator{\aff}{Aff}
\DeclareMathOperator{\isom}{Isom}

\DeclareMathOperator{\im}{Im}
\DeclareMathOperator{\re}{Re}
\DeclareMathOperator{\sign}{sign}




\title{Problemi di minimo su reti di comunicazioni e teoria dei giochi}
\date{\today}
\author{Enrico Polesel}
%\institute{Universit\`a di Pisa}


\begin{document}
\maketitle



\section{Introduzione e instradamento socialmente ottimo}

\subsection{Definizioni ed esempi}

\begin{frame}{Esempi}
  Reti:
  \begin{itemize}
  \item Reti stradali,
%  \item reti di distribuzione di risorse (e.g. gas),
  \item reti di telecomunicazione (internet).
  \end{itemize}

  Costi:
  \begin{itemize}
  \item Tempo di percorrenza (latenza),
  \item perdita di pacchetti,
  \item (costo economico).
  \end{itemize}

  Tipi di comportamento:
  \begin{itemize}
  \item Socialmente ottimo,
  \item anarchico (equilibrio di Wardrop),
  \item parzialmente ottimo.
  \end{itemize}
\end{frame}

\begin{frame}{Modello}
  \begin{center}
    \begin{tikzpicture}[mnode/.style={circle,fill=blue!20},>=latex,snode/.style={circle,fill=red!70}]
      \node[mnode] (1) at (0,0) {1};
      \node[mnode] (2) at (2,2) {2};
      \node[mnode] (3) at (4,2) {3};
      \node[mnode] (4) at (3,-2) {4};
      \node[mnode] (5) at (6,0) {5};
      \draw [->] (1) to [bend left] (2);
      \onslide<3->{\node at (1,1) {$l_1(x_1)$};}
      \draw [->] (2) to [bend right] (3);
      \onslide<3->{\node at (3,2.7) {$l_2(x_2)$};}
      \draw [->] (3) to [bend right] (2);
      \onslide<3->{\node at (3,1.3) {$l_3(x_3)$};}
      \draw [->] (3) to [bend left] (5);
      \onslide<3->{\node at (5.5,1.7) {$l_4(x_4)$};}
      \draw [->] (1) to [bend right] (4);
      \onslide<3->{\node at (0.6,-1.7) {$l_5(x_5)$};}
      \draw [->] (3) -- (4);
      \onslide<3->{\node at (4,0) {$l_6(x_6)$};}
      \draw [->] (4) -- (2);
      \onslide<3->{\node at (2,0) {$l_7(x_7)$};}
      \draw [->] (4) to [bend right] (5);
      \onslide<3->{\node at (5,-1) {$l_8(x_8)$};}

      \onslide<2->{
        \node[snode] (S1) at (-2,0) {S1};
        \node[snode] (S2) at (-2,2) {S2};
        \node[snode] (T1) at (8,0) {T1};
        \node[snode] (T2) at (8,-2) {T2};
        \draw[->] (S1) -- node[above]{traffico 1} (1);
        \draw[->] (5) -- node[above]{traffico 1} (T1);
        \draw[->] (S2) -- node[above]{traffico 2} (2);
        \draw[->] (4) -- node[below]{traffico 2} (T2);
      }
    \end{tikzpicture}
  \end{center}
  \begin{columns}[T]
    \begin{column}{.6\textwidth}
      \begin{itemize}
      \item<1-> Grafo diretto $(V,A)$,
      \item<2-> traffico (infinitamente divisibile),
      \end{itemize}
    \end{column}
    \begin{column}{.35\textwidth}
      \begin{itemize}
      \item<3-> costi.
      \end{itemize}
    \end{column}
  \end{columns}
\end{frame}

\begin{frame}{Istanza}
  Un'istanza di instradamento (\textit{routing instance}) è
  $R=(V,A,P,s,t,X,l)$ con:
  \begin{itemize}
  \item $(V,A)$ il grafo diretto,
  \item $s = \bra{s_i}_{i\in W}$ vettore delle sorgenti (per un opportuno $W$),
  \item $t = \bra{t_i}_{i\in W}$ vettore delle destinazioni,
  \item $P = \cup _{i\in W} P_i$ con $P_i$ insieme dei
    percorsi da $s_i$ a $t_i$,
  \item $X = \bra{X_i}_{i\in W}$ dove $X_i$ rappresenta la quantità di
    traffico da instradare da $s_i$ a $t_i$,
  \item $l = \bra{l_j}_{j\in A}$ dove $l_j(x_j)$ è il costo del link
    $j$ con un traffico $x_j$.
  \end{itemize}
  
  Supponiamo che le funzioni $l_j$ siano \textbf{non negative},
  \textbf{continue} e \textbf{non decrescenti}.

  Indichiamo con $\mathcal{R}$ l'insieme di tutte le istanze, con
  $\mathcal{R}^{aff},\mathcal{R}^{conv},$ i sottoinsiemi delle istanze con
  le $l_j$ rispettivamente affine e convesse.
\end{frame}

\begin{frame}{Soluzione di un'istanza e suo costo}
  Data un'istanza $R=(V,A,P,s,t,X,l)$ un vettore
  $x = \bra{x_j} \cup \bra{x_p}$ è soluzione se:
  \begin{itemize}
  \item $\displaystyle \forall p\in P\;\; x_p \ge 0$,
  \item $\displaystyle \forall j\in A\;\; x_j = \sum_{p\in P,p\ni j} x_p$,
  \item $\displaystyle \forall i\in W\;\; \sum_{p\in P_i} x_p = X_i$.
  \end{itemize}
  
  Il costo (globale) della soluzione sarà dato da:
  \[ C(x) = \sum_{j\in A} l_j(x_j)x_j \]
\end{frame}

\subsection{Instradamento socialmente ottimo}

\begin{frame}{Instradamento socialmente ottimo}
  \begin{mydef}[Instradamento socialmente ottimo]
    Diciamo che una soluzione $x$ di $R \in \mathcal{R}$ è
    \textbf{socialmente ottima} se minimizza la funzione costo
    $C(x) = \sum_{j\in A} l_j(x_j)x_j$, indichiamo una tale soluzione
    con $x^{SO}(R)$.
  \end{mydef}
  \[
    \begin{matrix}
      \text{minimizzare} & \sum _{j\in A} x_j l_j(x_j) \\
      \text{tale che} &   x_p \ge 0 & p\in P \\
      & x_j = \sum_{p\in P,p\ni j} x_p & j\in A \\
      &\sum_{p\in P_i} x_p = X_i & i\in W
    \end{matrix}
  \]
  \begin{myoss}
    I vincoli sono tutti lineari.
  \end{myoss}
  \begin{myoss}
    La soluzione potrebbe non essere unica.
  \end{myoss}
\end{frame}

\begin{frame}{Esempio di Pigou}
  \begin{center}
    \begin{tikzpicture}[mnode/.style={circle,fill=blue!20,minimum size=0.65cm},>=latex,snode/.style={circle,fill=red!70}]
      \node[mnode] (1) at (0,0) {s}; 
      \node[mnode] (2) at (3,0) {t};
      \draw [->] (1) to [bend left] node[above] {$l_1(x) = x$} (2);
      \draw [->] (1) to [bend right] node[below] {$l_2(x) = 1$} (2);
      \draw [->,color=red] (-4,0) -- node[above] {1 unità di traffico} (1) ;
      \draw [->,color=red] (2) --  (5,0) ;
      \node at (7,0) {};
    \end{tikzpicture}
  \end{center}
  La soluzione ottima è $x_1 = x_2 = \frac{1}{2}$ con costo
  \[ C(x) = \frac{1}{4} + \frac{1}{2} = \frac{3}{4} \]
  Metà del traffico arriverà con una latenza $\frac{1}{2}$ e metà con
  latenza $1$.
\end{frame}

\section{Equilibrio di Wardrop}

\subsection{Teoria dei giochi}

\begin{frame}{Definizione}
  \begin{mydef}[Gioco strategico]
    Un gioco è dato da $\pa{\mathcal{I},\pa{S_i}_{i\in\mathcal{I}},
      \pa{u_i}_{i\in\mathcal{I}}}$ con:
    \begin{itemize}
    \item $\mathcal{I}$ insieme \textbf{finito} dei giocatori,
    \item $S_i$ insieme non vuoto delle azioni possibili per il
      giocatore $i$,
    \item $u_i: \prod _{i\in\mathcal{I}} S_i \to \mathbb{R}$ guadagno
      per il giocatore $i$ in funzione delle azioni di tutti i
      giocatori.
    \end{itemize}
  \end{mydef}
  L'obiettivo di ogni giocatore è di massimizzare il proprio guadagno.

  Definiamo:
  \begin{itemize}
  \item $S = \prod _{i\in\mathcal{I}} S_i$,
  \item se $s = \bra{s_i}_{i\in\mathcal{I}} \in S$ allora $s_{-i} =
    \bra{s_j}_{j\neq i}$
  \item $\displaystyle S_{-i} = \prod _{j\in\mathcal{I},j\neq i} S_i$,
  \end{itemize}
\end{frame}

\begin{frame}{Esempio}
  In \textbf{matching pennies} ogni giocatore sceglie se mostrare una
  moneta con testa o croce, se le monete sono uguali vince il primo
  giocatore, se sono diverse il secondo.
  
  \begin{columns}[T]
    \begin{column}{0.4\textwidth}
      \[ \mathcal{I} = \set{1,2} \]
      \[ S_1 = S_2 = \set{\text{Testa},\text{Croce}} \]
    \end{column}
    \begin{column}{0.4\textwidth}
      \begin{tabular}{rcc}
        & Testa & Croce \\
        \cline{2-3}
        Testa & \multicolumn{1}{|c|}{$1,-1$} & \multicolumn{1}{|c|}{$-1,1$}  \\
        \cline{2-3}
        Croce & \multicolumn{1}{|c|}{$-1,1$} & \multicolumn{1}{|c|}{$1,-1$}  \\
        \cline{2-3}
      \end{tabular}
      \[ u_1,u_2 \]
    \end{column}
  \end{columns}
\end{frame}

\begin{frame}{Strategie}
  \begin{mydef}[Strategia dominante]
    Per un giocatore $i\in\mathcal{I}$ un'azione $s_i\in S_i$ è una
    strategia dominante se:
    \[ \forall s_{-i} \in S_{-i}\;\; \forall s_i' \in S_i\;\;\;
      u_i\pa{s_i,s_{-i}} \ge u_i\pa{s_i',s_{-i}} \]
  \end{mydef}

  Ci aspettiamo che un giocatore razionale giochi una strategia
  dominante, se esiste.
\end{frame}

\begin{frame}{Dilemma del prigioniero}
  Due criminali vengono arrestati per aver commesso un reato, hanno a
  disposizione due scelte: collaborare o non collaborare con la
  polizia.

  \begin{tabular}{rcc}
    & Non collaborare & Collaborare \\
    \cline{2-3}
    Non collaborare & \multicolumn{1}{|c|}{$-2,-2$} & \multicolumn{1}{|c|}{$-5,-1$}  \\
    \cline{2-3}
    Collaborare & \multicolumn{1}{|c|}{$-1,-5$} & \multicolumn{1}{|c|}{$-4,-4$}  \\
    \cline{2-3}
  \end{tabular}

  \begin{block}{Strategia dominante}
    Per entrambi la strategia ``collaborare'' è una strategia dominante.
  \end{block}
\end{frame}

\begin{frame}{Equilibrio di Nash}
  Sia  $\pa{\mathcal{I},\pa{S_i}_{i\in\mathcal{I}},
    \pa{u_i}_{i\in\mathcal{I}}}$ un gioco.
  \begin{mydef}[Equilibrio di Nash]
    $s^* \in S$ è un equilibrio di Nash se
    \[ \forall i\in \mathcal{I}\;\; \forall s_i \in S_i \;\;\;
      u_i\pa{s^*_i,s^*_{-i}} \ge u_i\pa{s_i,s^*_{-i}} \]
  \end{mydef}

  Nessun giocatore è interessato a spostarsi da un equilibrio di Nash.

  \begin{myoss}
    Se ogni giocatore ha a disposizione una strategia dominante allora
    l'insieme delle strategie dominanti è un equilibrio di Nash.

    Il viceversa in generale è falso.
  \end{myoss}
\end{frame}

\begin{frame}{Dilemma del prigioniero con suicidio}
    \begin{tabular}{rccc}
    & Non collaborare & Collaborare & Suicidarsi \\
    \cline{2-4}
    Non collaborare & \multicolumn{1}{|c|}{$-2,-2$} & \multicolumn{1}{|c|}{$-5,-1$} & \multicolumn{1}{|c|}{$0,-20$}  \\
    \cline{2-4}
    Collaborare & \multicolumn{1}{|c|}{$-1,-5$} & \multicolumn{1}{|c|}{$-4,-4$}  & \multicolumn{1}{|c|}{$-4,-20$} \\
    \cline{2-4}
    Suicidarsi & \multicolumn{1}{|c|}{$-20,0$} & \multicolumn{1}{|c|}{$-20,-4$}  & \multicolumn{1}{|c|}{$-20,-20$} \\
    \cline{2-4}
  \end{tabular}
  \vfill
  
  In questo caso non c'è una strategia dominante.

  \begin{block}{Equilibrio di Nash}
    $\pa{\text{Collaborare},\text{Collaborare}}$ è un equilibrio di Nash.
  \end{block}
\end{frame}

\begin{frame}{Esempi}
  \begin{columns}[T]
    \begin{column}{0.45\textwidth}
      \begin{tabular}{rcc}
        & Testa & Croce \\
        \cline{2-3}
        Testa & \multicolumn{1}{|c|}{$1,-1$} & \multicolumn{1}{|c|}{$-1,1$}  \\
        \cline{2-3}
        Croce & \multicolumn{1}{|c|}{$-1,1$} & \multicolumn{1}{|c|}{$1,-1$}  \\
        \cline{2-3}
      \end{tabular}
    \end{column}
    \begin{column}{0.45\textwidth}
      In \textbf{matching pennies} non esiste alcun equilibrio di Nash.
    \end{column}
  \end{columns}
  \vfill
  
  \begin{columns}[T]
    \begin{column}{0.45\textwidth}
      \begin{tabular}{rcc}
        & Opera & Football \\
        \cline{2-3}
        Opera & \multicolumn{1}{|c|}{$2,1$} & \multicolumn{1}{|c|}{$0,0$}  \\
        \cline{2-3}
        Football & \multicolumn{1}{|c|}{$0,0$} & \multicolumn{1}{|c|}{$1,2$}  \\
        \cline{2-3}
      \end{tabular}
    \end{column}
    \begin{column}{0.45\textwidth}
      Nella \textbf{battaglia dei sessi} esistono due equilibri di
      Nash: $\pa{\text{Opera},\text{Opera}}$ e
      $\pa{\text{Football},\text{Football}}$.
    \end{column}
  \end{columns}
\end{frame}

\subsection{Equilibrio di Wardrop}

\begin{frame}{Reti e utenti}
  Rivediamo l'esempio di Pigou dopo averlo ``discretizzato'' a due giocatori:
  \begin{center}
    \begin{tikzpicture}[mnode/.style={circle,fill=blue!20,minimum size=0.65cm},>=latex,snode/.style={circle,fill=red!70}]
      \node[mnode] (1) at (0,0) {s}; 
      \node[mnode] (2) at (3,0) {t};
      \draw [->] (1) to [bend left] node[above] {$l_1(x) = x/4$}
      node[below] {\small \textcolor{green}{$1$} \textcolor{blue}{$2$}} (2);
      \draw [->] (1) to [bend right] node[below] {$l_2(x) = 1/2$}
      node[above] {\small \textcolor{green}{$1$} \textcolor{blue}{$0$}}(2);
      \draw [->,color=red] (-4,0) -- node[above] {$2$ unità di traffico} (1) ;
      \draw [->,color=red] (2) --  (5,0) ;
      \node at (7,0) {};
    \end{tikzpicture}
  \end{center}
  
  \begin{columns}
    \begin{column}{0.56\textwidth}
      \begin{tabular}{rcc}
        & Link $1$ & Link $2$ \\
        \cline{2-3}
        Link $1$ & \multicolumn{1}{|c|}{$0.5,0.5$} & \multicolumn{1}{|c|}{$0.25,0.5$}  \\
        \cline{2-3}
        Link $2$ & \multicolumn{1}{|c|}{$0.5,0.25$} & \multicolumn{1}{|c|}{$0.5,0.5$}  \\
        \cline{2-3}
      \end{tabular}
      \vspace{3px}

      Strategia dominante: $\pa{\text{Link }1, \text{Link }1}$
    \end{column}
    \begin{column}{0.44\textwidth}
      \begin{tabular}{r|c}
        Soluzione & Costo totale \\
        \hline
        \textcolor{green}{Ottima} & $0.75$ \\
        \textcolor{blue}{Nash} & $1$
      \end{tabular}
    \end{column}
  \end{columns}
\end{frame}

\begin{frame}{Instradamento ``di Nash''}
  Per poter utilizzare l'equilibrio di Nash abbiamo bisogno di un
  \textbf{insieme finito di giocatori}, quindi dobbiamo
  \textbf{discretizzare il traffico}.

  Ma l'equilibrio di Nash potrebbe non esiste (o non essere unico) e
  potrebbe essere difficile da calcolare (diventa un problema di
  programmazione intera).
  \vfill

  Concentriamoci su problemi con una sorgente e una destinazione in
  cui il traffico è formato da unità discrete omogenee.
\end{frame}

\begin{frame}{Instradamento ``di Nash'': cos'è?}
  Nel nostro caso i giocatori sono dati dalle unità di traffico e
  l'insieme delle scelte è $P$, cioè l'insieme dei percorsi da
  sorgente a destinazione.
  \vfill
  
  Ricordiamo che $p^* \in P^{\mathcal{I}}$ è un equilibrio di Nash se
  \[ \forall i\in \mathcal{I}\;\; \forall p_i \in P \;\;\;
    u_i\pa{p^*_i,p^*_{-i}} \le u_i\pa{p_i,p^*_{-i}} \]
  dove $u_i\pa{p} = \sum _{j\in p_i} m\cdot l(x_j)$ è il costo pagato
  dall'utente $i$ per percorrere il percorso $p_i$.

  \begin{myoss}
    Dato $i$ e fissato $p^*_{-i}$ stiamo minimizzando la funzione
    \[ p_i \longmapsto u_i\pa{p_i,p^*_{-i}} \]
  \end{myoss}
\end{frame}

\begin{frame}{Equilibrio per molti giocatori}
  \begin{myoss}
    Dato $i$ e fissato $p^*_{-i}$ stiamo minimizzando la funzione
    \[ p_i \longmapsto u_i\pa{p_i,p^*_{-i}} \]
  \end{myoss}
  Dato $p^*_{-i}$ l'utente $i$ sta scegliendo il percorso meno
  costoso.
  \vfill
  
  Se il flusso di ogni utente è molto piccolo (stiamo pensando ad un
  limite) possiamo quindi dire che il costo dei percorsi scelti sarà
  (circa) uguale per tutti i giocatori e sarà quello minimo.
\end{frame}

\begin{frame}{Equilibrio di Wardrop}
  \begin{mydef}[Equilibrio di Wardrop per singola origine-destinazione]
    Una soluzione $x$ di $R\in \mathcal{R}$ è un \textbf{equilibrio di
      Wardrop} se
    \[
      \begin{matrix}
        \sum _{i\in p'} l_i(x_i) = \sum _{i\in p} l_i(x_i) & & \forall
        p,p'\in P \text{ con } x_p >0, x_{p'} >0 \\
        \sum _{i\in p'} l_i(x_i) \ge \sum _{i\in p} l_i(x_i) & & \forall
        p,p'\in P \text{ con } x_p >0, x_{p'} =0 
      \end{matrix}
    \]
    indichiamo con $x^{WE}(R)$ una tale soluzione.
  \end{mydef}

  \begin{myteo}[Realazione tra gli equilibri di Nash e
    Wardrop\footnote{A. Haurie and P. Yarcotte, On the Relationship
      between Nash-Cournot and Wardrop Equilibria, NETWORKS Vol 15(1985) 295-308, teoremi 3.1 e 3.2}]
    Sotto opportune ipotesi, data una rete $R$ e delle sue approssimazioni
    discrete $R_n$, se per ogni $n$ esiste un equilibrio di Nash allora
    l'equilibrio di Wardrop di $R$ coincide con il limite degli equilibri di
    Nash delle $R_n$.
  \end{myteo}
\end{frame}

\begin{frame}{Esempio di Pigou}
  \begin{center}
    \begin{tikzpicture}[mnode/.style={circle,fill=blue!20,minimum size=0.65cm},>=latex,snode/.style={circle,fill=red!70}]
      \node[mnode] (1) at (0,0) {s}; 
      \node[mnode] (2) at (3,0) {t};
      \draw [->] (1) to [bend left] node[above] {$l_1(x) = x$}
      node[below] {\small $1$} (2);
      \draw [->] (1) to [bend right] node[below] {$l_2(x) = 1$}
      node[above] {\small $0$} (2);
      \draw [->,color=red] (-4,0) -- node[above] {1 unità di traffico} (1) ;
      \draw [->,color=red] (2) --  (5,0) ;
      \node at (7,0) {};
    \end{tikzpicture}
  \end{center}
  \begin{align*}
    x^{WE}_1 = 1 & & x^{WE}_2 = 0 & \\
    x^{WE}_{p_1} = 1 & & x^{WE}_{p_2} = 0 & \\
    \sum_{j\in p_1} l_j\pa{x^{WE}_j} &= 1 & \sum_{j\in p_2} l_j\pa{x^{WE}_j} &= 1
  \end{align*}
  \begin{align*}
    C\pa{x^{SO}} = \frac{3}{4} && C\pa{x^{WE}} = 1
  \end{align*}
\end{frame}

\begin{frame}{Teorema di Beckmann, McGuire and Winsten}
  Manteniamo l'ipotesi di avere un'unica coppia origine-destinazione e
  supponiamo che il flusso richiesto sia $1$.
  \begin{myteo}[Beckmann, McGuire and Winsten]
    Data $R\in \mathcal{R}$ una soluzione $x$ è un equilibrio di
    Wardrop se e solo se $x$ è una soluzione del problema
    \begin{align*}
        \text{minimizzare} \;&  \sum _{j\in A} \int _0 ^ {x_j}
        l_j(z)\de z \\
        \text{con} \;& \sum _{p\in P, p\ni j} x_p = x_j&\;\; \forall j\in
        A\\
        & \sum _{p\in P} x_p = 1 \\
        & x_p \ge 0&\;\;\forall p\in P        
    \end{align*}
  \end{myteo}
\end{frame}

\begin{frame}{Teorema di Beckmann, McGuire and Winsten}
  Scriviamo le funzioni:
  \begin{align*}
    f(x) &= \sum _{j\in A} \int _0 ^ {x_j} l_j(z)\de z \\
    g_p(x) &= -x_p & \forall p\in P \\
    h_j(x) &= \sum _{p\ni j} x_p -x_j & \forall j\in A\\
    h(x) &= \sum _{p\in P} x_p -1
  \end{align*}
  
  Il problema diventa minimizzare $f(x)$ con $g_p(x) \le 0$, $h_j(x)
  =0$ e $h(x) =0$.

  Abbiamo supposto all'inizio le $l_j$ continue, non negative e non
  decrescenti, quindi $f$ è una funzione convessa.
\end{frame}

\begin{frame}{Dimostrazione del teorema}
  \begin{proof}
    \renewcommand{\qedsymbol}{} Abbiamo già osservato che $f$ è
    convessa, inoltre i vincoli sono tutti lineari, quindi sappiamo
    che $x$ è punto di minimo se e solo se sono soddisfatte le KKT in
    $x$: $\exists \lambda \in \mathbb{R}_+^{\abs{P}}$,
    $\exists \mu \in \mathbb{R}^{\abs{A}}$,
    $\exists \theta \in \mathbb{R}$ tali che:
    \[ 0 = \nabla f(x) + \sum_{p\in P}\lambda _p \nabla g_p(x) + \sum _{j\in
        A} \mu _j \nabla h_j(x) + \theta \nabla h(x) \]
    \[ \forall p\in P\;\; \lambda _p g_p(x) = 0 \]
    \vspace{-20px}
    \begin{align*}
      l_j(x_j) - \mu _j =0 && \forall j\in A \\
      -\lambda _p + \sum _{p\ni j}\mu _j + \theta =0 && \forall p \in
                                                        P\\
      \lambda _p x_p =0 && \forall p\in P
    \end{align*}
  \end{proof}
\end{frame}

\begin{frame}{Dimostrazione del teorema}
  \begin{proof}[Dimostrazione (continua)]
    Ricaviamo quindi
    \begin{align*}
      \sum _{p\ni j} l_j(x_j) &= -\theta + \lambda _p \ge -\theta &
                                                \forall p\in P  \\
      x_p > 0 &\Rightarrow \lambda _p =0 & \forall p\in P
    \end{align*}
    Da cui:
    \begin{align*}
      x_p > 0 & \Rightarrow \sum _{p\ni j} l_j(x_j) = -\theta \\
      x_p = 0 & \Rightarrow \sum _{p\ni j} l_j(x_j) \ge -\theta
    \end{align*}
    queste sono le condizioni dell'equilibrio di Wardrop.
  \end{proof}
\end{frame}

\begin{frame}{Equilibrio di Wardrop per più coppie sorgente-destinazione}
  \begin{mydef}[Equilibrio di Wardrop]
    Una soluzione $x$ di $R\in \mathcal{R}$ è un \textbf{equilibrio di
      Wardrop} se per ogni coppia di sorgente-destinazione
    $(s_i,t_i)$:
    \begin{align*}
      \sum _{j\in p'} l_j(x_j) = \sum _{j\in p} l_j(x_j) & & \forall
                                                             p,p'\in P_i \text{ con } x_p >0, x_{p'} >0 \\
      \sum _{j\in p'} l_j(x_j) \ge \sum _{j\in p} l_j(x_j) & & \forall
                                                               p,p'\in P_i \text{ con } x_p >0, x_{p'} =0 
    \end{align*}
    indichiamo con $x^{WE}(R)$ una tale soluzione.
  \end{mydef}  
\end{frame}

\begin{frame}{Teorema di Beckmann, McGuire and Winsten}
  \begin{myteo}[Beckmann, McGuire and Winsten]
    Data $R\in \mathcal{R}$ una soluzione $x$ è un equilibrio di
    Wardrop se e solo se $x$ è una soluzione del problema
    \begin{align*}
        \text{minimizzare} \;&  \sum _{j\in A} \int _0 ^ {x_j}
        l_j(z)\de z \\
        \text{con} \;& \sum _{p\in P, p\ni j} x_p = x_j&\forall j\in
        A\\
        & \sum _{p\in P_i} x_p = X_i& \forall i\in W\\
        & x_p \ge 0&\forall p\in P        
    \end{align*}
  \end{myteo}
\end{frame}


\begin{frame}{Esistenza e unicità dell'equilibrio di Wardrop}
  \begin{myteo}
    Dato $R\in \mathcal{R}$ esiste sempre un equilibrio di Wardrop
    $x^{WE}(R)$.

    Inoltre se le funzioni $l_j$ sono \textbf{strettamente crescenti}
    allora l'equilibrio di Wardrop è unico.
  \end{myteo}
  \begin{proof}
    Il problema del teorema di Beckmann, McGuire and Winsten è
    convesso, quindi esiste sempre una soluzione.

    Se tutte le funzioni $l_i$ sono strettamente crescenti allora la
    funzione obiettivo è strettamente convessa e quindi la soluzione è
    unica.
  \end{proof}
\end{frame}

\subsection{Il prezzo dell'anarchia (PoA)}

\begin{frame}{Inefficienza dell'equilibrio}
  Abbiamo già visto nell'esempio di Pigou che la soluzione
  dell'equilibrio di Wardrop può avere un costo globale maggiore di
  quello della soluzione socialmente ottima.

  Siamo interessati a capire quanto può peggiorare il costo, definiamo
  per ogni rete $R \in \mathcal{R}$ la quantità
  \[ \frac{C\pa{ x^{SO}}}{C\pa{ x^{WE}}} \]
  \begin{mydef}[Prezzo dell'anarchia (PoA)]
    Dato $\mathcal{R}' \subseteq \mathcal{R}$ siamo interessati alla
    quantità
    \[ \inf _{R\in \mathcal{R}'} \frac{C\pa{ x^{SO}}}{C\pa{
          x^{WE}}} \]
  \end{mydef}
\end{frame}

\begin{frame}{PoA per funzioni convesse}
  Abbiamo definito in precedenza $\mathcal{R}^{conv} \subseteq
  \mathcal{R}$ l'insieme delle istanze in cui le funzioni latenza
  $l_j$ sono tutte convesse.
  \begin{myteo}[Roughgarden and Tardos]
    \[ \inf _{R\in \mathcal{R}^{conv}} \frac{C\pa{ x^{SO}}}{C\pa{
          x^{WE}}} = 0 \]
  \end{myteo}
\end{frame}

\begin{frame}
  \begin{proof}
    \begin{center}
      \begin{tikzpicture}[mnode/.style={circle,fill=blue!20,minimum size=0.65cm},>=latex,snode/.style={circle,fill=red!70}]
        \node[mnode] (1) at (0,0) {s}; 
        \node[mnode] (2) at (3,0) {t};
        \draw [->] (1) to [bend left] node[above] {$l_1(x) = x^k$} (2);
        \draw [->] (1) to [bend right] node[below] {$l_2(x) = 1$} (2);
        \draw [->,color=red] (-4,0) -- node[above] {1 unità di traffico} (1) ;
        \draw [->,color=red] (2) --  (5,0) ;
        \node at (7,0) {};
      \end{tikzpicture}
    \end{center}
    \vspace{-25px}
    \begin{align*}
      x^{SO}_1 &= \pa{k+1}^{-1/k} & x^{SO}_2 = 1- \pa{k+1}^{-1/k}
    \end{align*}
    \[ C\pa{x^{SO}} = 1 - \frac{k}{k+1}x^{SO}_1 \]
    \begin{align*}
      x^{WE}_1 &= 1 & x^{WE}_2 &= 0 & C\pa{x^{WE}} = 1
    \end{align*}
    Per $k\to \inf$ si ha che $x^{SO}_1 \to 1$ e $C\pa{x^{SO}}\to 0$.
  \end{proof}
\end{frame}

\begin{frame}{PoA per funzioni affini e concave}
  Abbiamo definito in precedenza
  $\mathcal{R}^{aff} \subseteq \mathcal{R}$ e $\mathcal{R}^{conc}
  \subseteq \mathcal{R}$  gli insiemi delle istanze in
  cui le funzioni latenza $l_j$ sono tutte rispettivamente affini e concave.
  \begin{myteo}[Roughgarden and Tardos]
    \[ \inf _{R\in \mathcal{R}^{aff}} \frac{C\pa{ x^{SO}}}{C\pa{
          x^{WE}}} = \frac{3}{4} \]
  \end{myteo}
  % \begin{myteo}[\footnote{D. Acemoglu, R. Johari e A. Ozdaglar, Partially Optimal Routing,
  %     IEEE Journal on Selected Areas in Communications, vol. 25,
  %     No. 6, August 2007, Lemma 2}]
  \begin{myteo}[\footnote{I. Menache e A. Ozdaglar, Network Games,
      Morgan \& Claypool Publishers, 2010, Lemma 3.10}]
    \[ \inf _{R\in \mathcal{R}^{conc}} \frac{C\pa{ x^{SO}}}{C\pa{
          x^{WE}}} = \frac{3}{4} \]
  \end{myteo}
\end{frame}

\subsection{Paradosso di Braess}

\begin{frame}{Esempio}
  \begin{center}
    \begin{tikzpicture}[mnode/.style={circle,fill=blue!20,minimum size=0.65cm},>=latex,snode/.style={circle,fill=red!70}]
      \node[mnode] (0) at (0,0) {0}; 
      \node[mnode] (1) at (3,2) {1};
      \node[mnode] (2) at (3,-2) {2};
      \node[mnode] (3) at (7,0) {3};
      \draw [->] (0) to node[below] {x} (1);
      \draw [->] (0) to node[above] {1} (2);
      \draw [->] (1) to node[below] {1} (3);
      \draw [->] (2) to node[above] {x} (3);
%      \draw [->] (1) to [bend left] node[above] {$l_1(x) = x^k$} (2);
%      \draw [->] (1) to [bend right] node[below] {$l_2(x) = 1$} (2);
      \draw [->,color=red] (-1,0) -- node[above,color=black] {1} (0) ;
      \draw [->,color=red] (0) to [bend left] node[below,color=blue]{$1/2$} (1);
      \draw [->,color=red] (0) to [bend right] node[above,color=blue]{$1/2$} (2);
      \draw [->,color=red] (1) to [bend left] node[below,color=blue]{$1/2$} (3);
      \draw [->,color=red] (2) to [bend right] node[above,color=blue]{$1/2$} (3);
      \draw [->,color=red] (3) -- (8,0) ;
      \onslide<2-> {
        \draw [->] (1) to node[left] {0} (2);
      }
      \onslide<3-> {
        \draw [->,color=red,line width=1.5pt] (1) to [bend left] node[right,color=red]
        {1} (2);
        \draw [->,color=red,line width=1.5pt] (0) to [bend left] node[above]{$1$} (1);
        \draw [->,color=red,line width=1.5pt] (2) to [bend right] node[below]{$1$} (3);
        \draw [->,color=red,line width=1.5pt] (-1,0) -- (0) ;
        \draw [->,color=red,line width=1.5pt] (3) -- (8,0) ;
      }
    \end{tikzpicture}
  \end{center}
  \begin{tabular}{r|cc}
    & $C\pa{x^{SO}}$ & $C\pa{x^{WE}}$ \\
    \hline
    \onslide<2->{Senza 1-2} & $\sfrac{3}{2}$ & $\sfrac{3}{2}$ \\
    \onslide<3->{Con 1-2 & $\sfrac{3}{2}$ & $1$}
  \end{tabular}
\end{frame}

\begin{frame}{Sottoreti}
  \begin{mydef}[Sottorete]
    Data un'istanza $R=(V,A,P,s,t,X,l)$ diciamo che
    $R_0=(V_0,A_0,P_0,s_0,t_0)$ è una \textbf{sottorete} di $R$ se:
    \begin{itemize}
    \item $V_0 \subseteq V$ e $A_0 = A \cap \pa{V_0\times V_0}$,
    \item tutti i percorsi di $P$ passanti per $\pa{V_0,A_0}$
      contengono un percorso in $P_0$ da $s_0$ in $t_0$ sugl'archi di
      $A_0$.
    \end{itemize}
    Scriviamo $R_0\subseteq R$.
  \end{mydef}
\end{frame}

\begin{frame}{Paradosso di Braess}
  \begin{mydef}[Paradosso di Braess]
    Data una rete $R=(V,A,P,s,t,X,l)$ e una sua sottorete
    $R_0=(V_0,A_0,P_0,s_0,t_0)$ diciamo che esiste un
    \textbf{paradosso di Braess} in $R$ centrato in $R_0$ se esiste
    un'altra istanza nella forma $R_m=(V,A,P,s,t,X,m)$ tale che:
    \begin{itemize}
    \item $\forall j\in A$ e $\forall x_j \ge0$
      \begin{itemize}
      \item $j \in A_0 \longrightarrow m_j(x_j) \le l_j(x_j)$,
      \item $j \not\in A_0\longrightarrow m_j(x_j) = l_j(x_j)$;
      \end{itemize}
    \item $C\pa{x^{WE}\pa{R_m}} > C\pa{x^{WE}\pa{R}}$.
    \end{itemize}
  \end{mydef}
\end{frame}

\section{Instradamento parzialmente ottimo}

\subsection{Provider e sottoreti}

\begin{frame}{Provider}
  Dato un servizio (ad esempio la rete internet) potrebbero esiste più
  fornitori (provider) che scambiano tra loro il traffico, ogni
  fornitore prenderà decisioni all'interno della propria
  \textbf{sottorete}.

  Data una rete $R$ la presenza di $k$ provider è data dalle loro
  sottoreti $R_1,...,R_k$ \textbf{disgiunte} (cioè tali che $V_i\cap
  V_j = \emptyset$). \vfill

  Ci concentriamo nel caso in cui ci sia un unico provider con una
  sottorete $R_0$ mentre il resto della rete è indipendente.

  Sia $R=(V,A,P,s,t,X,l)$ una rete e $R_0=(V_0,A_0,P_0,s_0,t_0)
  \subseteq R$. Ricordiamo che tutti i percorsi in $P$ passanti per
  $R_0$ entrano in $s_0$ ed escono in $t_0$.
  \vfill
\end{frame}

\begin{frame}{Instradamento dentro un provider}
  \begin{mydef}[Latenza effettiva]
    Dato $X_0\in\mathbb{R}$ definiamo $L\pa{X_0}$ il costo globale di
    una soluzione \textbf{socialmente ottima} di $R_0$ con $X_0$ unità
    di traffico, definiamo quindi la \textbf{latenza effettiva} di
    $R_0$ come
    \[ l_0(X_0) = \frac{L\pa{X_0}}{X_0} \]
  \end{mydef}
  In questo modo il provider garantisce un instradamento ottimo dentro
  la rete di sua competenza.
\end{frame}
\begin{frame}{Proprietà della latenza effettiva}
  \begin{mylem}
    La funzione $l_0$ è continua, non negativa e non decrescente.
  \end{mylem}
  \begin{mylem}
    Se $R\in \mathcal{R}^{conv}$ allora $L_0$ è convessa.
  \end{mylem}
  \begin{mylem}
    Sia $R\in \mathcal{R}^{aff}$ allora $l_0$ è concava.
  \end{mylem}
\end{frame}

\begin{frame}{Instradamento globale}
  Data una rete $R$ è una sua sottorete $R_0$ calcoliamo la latenza
  effettiva di $R_0$, definiamo quindi $R'=(V',A',P',s,t,X,l')$ con
  \begin{itemize}
  \item $V' = \pa{V\setminus V_0}\cup \set{s_0,t_0}$,
  \item $A' = \pa{A\setminus A_0}\cup \set{\pa{s_0,t_0}}$,
  \item $P'$ i percorsi di $P$ con $\pa{s_0,t_0}$ al posto dei
    percorsi in $P_0$,
  \item Per $j\in A\setminus A_0$ definiamo $l'_j = l_j$
  \item $l'_{\pa{s_0,t_0}} = l_0$.
  \end{itemize}

  \begin{mydef}[Instradamento parzialmente ottimo]
    Diciamo che $x$ soluzione di $R$ è un \textbf{instradamento
      parzialmente ottimo} se su $A\setminus A_0$ coincide con
    $x^{WE}(R')$, indichiamo tale soluzione con
    \[ x^{POR}(R,R_0) \]
  \end{mydef}
\end{frame}

\begin{frame}{Osservazioni}
  \begin{itemize}
  \item In $x^{POR}$ non è ben definito il flusso sugl'archi di $R_0$,
    infatti la soluzione di $x^{SO}(R_0)$ potrebbe non essere unica;
  % \item le soluzioni $x^{SO}$ e $x^{WE}$ possono essere viste come
  %   instramenti parzialmente ottimi (rispettivamente con $R_0=R$ e
  %   $R_0=\emptyset$);
  \item il conecetto di latenza effettiva può essere utilizzato anche
    quando il provider instrada il traffico secondo un equilibrio di
    Wardrop locale, in questo caso l'instradamento globale sarà un
    equilibrio di Wardrop;
  \item la definizione di instradamento parzialmente ottimo può essere
    estesa a più provider disgiunti sostituendo ognuno con la propria
    latenza effettiva;
  \item questo modello non è facilmente estendibile al caso di
    provider con multipli punti di accesso e/o uscita.
  \end{itemize}
\end{frame}

\subsection{Efficienza e limiti}

\begin{frame}{Esempio}
  \begin{center}
    \begin{tikzpicture}[mnode/.style={circle,fill=blue!20,minimum size=0.65cm},>=latex,snode/.style={circle,fill=red!70}]
      \node[mnode] (0) at (0,0) {0}; 
      \node[mnode] (1) at (4,2) {1};
      \node[mnode] (2) at (4,-2) {2};
      \node[mnode] (3) at (8,0) {3};
      \draw [->] (0) to node[above] {$x$} (1);
      \draw [->] (0) to node[below] {$1.25$} (2);
      \draw [->] (1) to node[above] {$3.25$} (3);
      \draw [->] (2) to node[below] {$3x$} (3);
      \draw [->,blue] (1) to [bend right] node[left] {$l_5(x) = 0.31$} (2);
      \draw [->,blue] (1) to [bend left] node[right] {$l_6(x) = 0.4x$} (2);
%      \draw [->] (1) to [bend left] node[above] {$l_1(x) = x^k$} (2);
%      \draw [->] (1) to [bend right] node[below] {$l_2(x) = 1$} (2);
      \draw [->,color=red] (-1,0) -- node[above,color=black] {$1$} (0) ;
      % \draw [->,color=red] (0) to [bend left] node[below,color=blue]{$1/2$} (1);
      % \draw [->,color=red] (0) to [bend right] node[above,color=blue]{$1/2$} (2);
      % \draw [->,color=red] (1) to [bend left] node[below,color=blue]{$1/2$} (3);
      % \draw [->,color=red] (2) to [bend right] node[above,color=blue]{$1/2$} (3);
      \draw [->,color=red] (3) -- (9,0) ;
      \only<2> {
        \draw [dashed,->] (1) to node {$\tilde l_0(X_0)$}(2) ;
      }
      \onslide<3-> {
        \draw [dashed,->] (1) to node {$l_0(X_0)$}(2) ;
      }
    \end{tikzpicture}
  \end{center}
  \only<2>{
    Se il traffico viene instradato secondo un equilibrio di Wardrop
    abbiamo:
    \[ \tilde l_0(X_0) = \min\pa{0.31,0.4X_0} \]
    con un costo globale $C\pa{x^{WE}(R)} = 4.19$.
  }
  \only<3>{
    Se il traffico viene ottimizzato dentro il provider abbiamo:
    \[ l_0(X_0) = \left\{ 
        \begin{matrix}
          0.4X_0 & \text{se }0\le X_0\le 0.3875 \\
          0.31 - \frac{0.0961}{1.6X_0} & \text{se } X_0 \ge 0.8375
        \end{matrix}
        \right.
      \]
    con un costo globale $C\pa{x^{POR}(R,R_0)} = 4.25$.
  }
  \only<4>
  {
    Confrontando i due metodi otteniamo:
    \begin{center}
      \begin{tabular}{r|cc}
        & WE & POR \\
        \hline
        Costo globale & 4.19 & 4.25
      \end{tabular}
    \end{center}
  }
\end{frame}

\begin{frame}{POR paradox}
  \begin{mydef}[POR paradox]
    Data un'istanza $R$ e una sua sottorete $R_0 \subseteq R$ diciamo
    che abbiamo un \textbf{partially optimal routing paradox} in $R$
    centrato in $R_0$ se 
    \[ C\pa{ x^{POR} (R,R_0)} > C\pa{ x^{WE} (R)} \]
  \end{mydef}
  
  Nell'esempio precedente abbiamo visto un caso in cui la soluzione
  parzialmente ottima peggiora il costo globale, quindi un caso di
  paradosso POR.
\end{frame}


\begin{frame}{Paradosso POR e paradosso di Braess}
  \begin{myteo}[Paradosso POR come paradosso di Braess\footnote{D.
      Acemoglu, R. Johari e A. Ozdaglar, Partially Optimal Routing,
      IEEE Journal on Selected Areas in Communications, vol. 25,
      No. 6, August 2007, Proposizione 1}]
    Se una rete $R$ ha un \textbf{paradosso POR} centrato in
    $R_0\subseteq R$ allora esiste un \textbf{paradosso di Braess} in
    $R$ centrato in $R_0$.
  \end{myteo}
  \begin{mycor}
    Data un'istanza $R$, se non ci sono paradossi di Braess in $R$
    allora la soluzione POR rispetto a qualsiasi sottorete \textbf{non
    peggiora} il costo globale.
  \end{mycor}
\end{frame}

\begin{frame}{Efficienza del POR}
  Analogamente a come abbiamo fatto con l'equilibrio di Wardrop,
  siamo interessati a dare dei limiti alla quantità
  \[ \inf _{\tiny\begin{matrix}R\in \mathcal{R}'\\R_0\subseteq
        R\end{matrix}}
    \frac{C\pa{x^{SO}(R)}}{C\pa{x^{POR}(R,R_0)}} \]
  per opportuni sottoinsiemi di reti $\mathcal{R}' \subseteq
  \mathcal{R}$.
  
\end{frame}

\begin{frame}
  \begin{mypro}
    \begin{enumerate}
    % \item $\forall \mathcal{R}' \in \set{\mathcal{R}^{conv},
    %     \mathcal{R}^{aff}, \mathcal{R}^{conc}}$ si ha
    \item $\forall \mathcal{R}' \subseteq \mathcal{R}$ si ha
        \[ \inf _{\tiny\begin{matrix}R\in \mathcal{R}'\\R_0\subseteq
              R\end{matrix}}
          \frac{C\pa{x^{SO}(R)}}{C\pa{x^{POR}(R,R_0)}} \le
          \inf _{R\in \mathcal{R}'}
          \frac{C\pa{x^{SO}(R)}}{C\pa{x^{WE}(R)}}
        \]
      \item
        \[ \inf _{\tiny\begin{matrix}R\in \mathcal{R}\\R_0\subseteq
              R\end{matrix}}
          \frac{C\pa{x^{SO}(R)}}{C\pa{x^{POR}(R,R_0)}} =
          \inf _{R\in \mathcal{R}}
          \frac{C\pa{x^{SO}(R)}}{C\pa{x^{WE}(R)}}
        \]
      \item
        \[ \inf _{\tiny\begin{matrix}R\in \mathcal{R}^{aff}\\R_0\subseteq
              R\end{matrix}}
          \frac{C\pa{x^{SO}(R)}}{C\pa{x^{POR}(R,R_0)}} \ge
          \inf _{R\in \mathcal{R}^{conc}}
          \frac{C\pa{x^{SO}(R)}}{C\pa{x^{WE}(R)}}
        \]
    \end{enumerate}
  \end{mypro}
\end{frame}

\begin{frame}{Efficienza per problemi lineari e convessi}
  \begin{myteo}
  \[ \inf _{\tiny\begin{matrix}R\in \mathcal{R}^{conv}\\R_0\subseteq
        R\end{matrix}}
    \frac{C\pa{x^{SO}(R)}}{C\pa{x^{POR}(R,R_0)}} = 0\]    
  \[ \inf _{\tiny\begin{matrix}R\in \mathcal{R}^{aff}\\R_0\subseteq
        R\end{matrix}}
    \frac{C\pa{x^{SO}(R)}}{C\pa{x^{POR}(R,R_0)}} = \frac{3}{4} \]    
  \end{myteo}
\end{frame}

\begin{frame}
  \begin{proof}[Dimostrazione (primo punto)]
    Dal teorema di Roughgarden and Tardos sappiamo che 
    \[ \inf _{R\in \mathcal{R}^{conv}} \frac{C\pa{ x^{SO}(R)}}{C\pa{
          x^{WE}(R)}} = 0 \]
    mentre dal primo punto della propozione precendente abbiamo
    \[ \inf _{\tiny\begin{matrix}R\in \mathcal{R}^{conv}\\R_0\subseteq
          R\end{matrix}}
      \frac{C\pa{x^{SO}(R)}}{C\pa{x^{POR}(R,R_0)}} \le
      \inf _{R\in \mathcal{R}^{conv}}
      \frac{C\pa{x^{SO}(R)}}{C\pa{x^{WE}(R)}}
    \]
    da cui la tesi
    \[ \inf _{\tiny\begin{matrix}R\in \mathcal{R}^{conv}\\R_0\subseteq
        R\end{matrix}}
    \frac{C\pa{x^{SO}(R)}}{C\pa{x^{POR}(R,R_0)}} = 0\]    
  \end{proof}
\end{frame}

\begin{frame}
  \begin{proof}[Dimostrazione (secondo punto)]
    Dalla teorema sull'efficienza dell'equilibrio di Wardrop per
    funzioni concave sappiamo che
    \[ \inf _{R\in \mathcal{R}^{conc}} \frac{C\pa{ x^{SO}(R)}}{C\pa{
          x^{WE}(R)}} = \frac{3}{4} \]
    mentre il terzo punto della proposizione ci dice che
    \[ \inf _{\tiny\begin{matrix}R\in \mathcal{R}^{aff}\\R_0\subseteq
          R\end{matrix}}
      \frac{C\pa{x^{SO}(R)}}{C\pa{x^{POR}(R,R_0)}} \ge
      \inf _{R\in \mathcal{R}^{conc}}
      \frac{C\pa{x^{SO}(R)}}{C\pa{x^{WE}(R)}}
    \]
    quindi
    \[ \inf _{\tiny\begin{matrix}R\in \mathcal{R}^{aff}\\R_0\subseteq
          R\end{matrix}}
      \frac{C\pa{x^{SO}(R)}}{C\pa{x^{POR}(R,R_0)}} \ge \frac{3}{4} \]    
    applicando il primo punto della proposizone con $\mathcal{R}' =
    \mathcal{R}^{aff}$ e utilizzando il teorema di Roughgarden and
    Tardos per funzioni affini abbiamo la tesi.
  \end{proof}
\end{frame}

\begin{frame}{Estensioni\footnote{D. Acemoglu, R. Johari e
      A. Ozdaglar, Partially Optimal Routing, IEEE Journal on Selected
      Areas in Communications, vol. 25, No. 6, August 2007,
      Proposizione 1}}
  \begin{itemize}
  \item Si possono dare dei limiti inferiori all'efficienza per reti
    le cui funzioni latenza sono polinomi di grado limitato;
  \item quando si considerano reti i cui provider possono avere più
    punti di ingresso o uscita l'efficienza può essere piccola a
    piacere anche limitandosi a funzioni latenza lineari.
  \end{itemize}
\end{frame}

\section{Concorrenza sui costi}

\subsection{Modello}

\begin{frame}{Motivazioni}
  Vogliamo aggiungere al nostro modello un costo economico che il
  provider fa pagare all'utente per ogni unità di traffico inviata
  sulla sua rete.

  I provider sceglieranno i costi in modo da massimizzare il loro
  profitto mentre gli utenti sceglieranno quale link utilizzare per
  minimizzare la latenza ed il costo della trasmissione.

  Bisognerà anche prevedere un limite superiore (\textit{reservation
    utilty}) al costo (sia in termini di latenza che in termini di
  spesa) che l'utente è disposto a sostenere.
\end{frame}

\begin{frame}{Modello}
  Supponiamo che la nostra rete sia costituita da $I$ archi
  $\mathcal{I} = \set{1,...,I}$ in parallelo ognuno con una funzione
  latenza $l_i$ convessa, non decrescente, differenziabile e nulla in
  $0$.

  Dato un vettore dei costi $\bra{p_1,...,p_I}$ il costo pagato per
  attraversare l'arco $i$ con un traffico $x_i$ sarà:
  \[ x_i \pa{ l_i(x_i) + p_i} \]

  \begin{center}
    \begin{tikzpicture}[mnode/.style={circle,fill=blue!20},>=latex,snode/.style={circle,fill=red!70}]
      \node[mnode] (s) at (0,0) {s};
      \node[mnode] (t) at (5,0) {t};
      \draw [->,color=blue] (s) to [bend left=40] node[above] {\small $l_1(x_1)$, $p_1$} (t);
      \draw [->,color=green] (s) to [bend left=20] node[above] {\small $l_2(x_2)$, $p_2$} (t);
      \draw [->,color=black] (s) to node[above] {\small $l_3(x_3)$, $p_3$} (t);
      \draw [->,color=black] (s) to [bend right=20] node[above] {\small $l_4(x_4)$, $p_4$} (t);
      \draw [->,color=magenta] (s) to [bend right=40] node[above] {\small $l_5(x_5)$, $p_5$} (t);
    \end{tikzpicture}
  \end{center}
\end{frame}

\begin{frame}{Soluzione}
  Dato il nostro insieme di link $\mathcal{I}$, le loro funzioni
  latenza $\bra{l_i}_i\in\mathcal{I}$ e il vettore dei prezzi
  $\bra{p_i}_{i\in\mathcal{I}}$ scelti dai provider diciamo che un
  vettore $x\in \mathbb{R}_+^\mathcal{I}$ è \textbf{soluzione del
    problema} se:
  \begin{align*}
    l_i(x_i) + p_i &\le R \\
    \sum _{i\in \mathcal{I}} x_i &\le d 
  \end{align*}
  Dove $R$ è la \textit{reservation utility} (il massimo costo totale
  che gli utenti sono disposti a pagare) e $d$ è la quantità di
  traffico che si vuole far passare.
\end{frame}

\begin{frame}{Comportamento degli utenti}
  \begin{mydef}
    Una soluzione $x\in \mathbb{R}_+^\mathcal{I}$ è un
    \textbf{equilibrio di Wardrop} se:
    \begin{align*}
      l_i(x_i) + p_i &= \min _j \set{l_j(x_j)+p_j} & \forall i\text{ con } x_i>0 \\
      l_i(x_i) + p_i &\le R \\
      \sum _{i\in \mathcal{I}} x_i &\le d \\
      \sum _{i\in \mathcal{I}} x_i &= d & \text { se } \min _j
                                          \set{l_j(x_j)+p_j} <R
    \end{align*}
    indichiamo una tale soluzione con $x^{WE}$.
  \end{mydef}
  Chiamiamo $W(p)$ l'insieme degli equilibri di Wardrop con vettore
  dei prezzi $p$.
\end{frame}

\begin{frame}{Social surplus}
  \begin{mydef}[Social surplus]
    Data una soluzione $x$ chiamiamo \textit{social surplus} la
    quantità:
    \[ \mathbb{S}(x) = \sum _{i\in\mathcal{I}}\pa{ R -
        l_i\pa{x_i}}x_i \]
  \end{mydef}
  Questa funzione rappresenta la differenza tra quanto gli utenti sono
  disposti a spendere e quanto spendono in \textbf{latenza}.
  \vfill
  
  Per $R$ sufficientemente grande (quando tutto il traffico viene
  instradato) si ha:
  \[ \mathbb{S}(x) = Rd - C(x) \]
\end{frame}

\begin{frame}{Ottimo sociale}
  \begin{mydef}[Soluzione socialmente ottima]
    Diciamo che una soluzione è un \textbf{ottimo sociale} se risolve il
    problema:
    \begin{align*}
      \text{massimizzare }\;\; & \mathbb{S}(x) = \sum
                            _{i\in\mathcal{I}}\pa{ R - l_i\pa{x_i}}x_i
      \\
      \text{tale che }\;\; & x\ge 0\\
      & \sum _{i\in \mathcal{I}} x_i \le d
    \end{align*}
    indichiamo una tale soluzione con $x^S$.
  \end{mydef}
\end{frame}

\subsection{Monopoli e oligopoli}

\begin{frame}{Equilibrio in presenza di un monopolio}
  Supponiamo che tutti i link $\mathcal{I}$ siano gestiti da un
  monopolista che vuole massimizzare il suo profitto
  \[ \Pi (p,x) = \sum _{i\in\mathcal{I}} p_i x_i \]

  Dati i parametri $R$ e $d$ il monopolista deciderà il vettore dei
  prezzi.
  \begin{mydef}[Equilibrio di monopolio]
    I vettori $\pa{p^{ME},x^{ME}}\ge 0$ sono un \textbf{equilibrio di
      monopolio} se $x^{ME}\in W(p^{ME})$ e 
    \begin{align*}
      \forall p\ge 0,\; \forall x\in W(p) && \Pi \pa{p^{ME},x^{ME}}
                                             \ge \Pi \pa{p,x}
    \end{align*}
  \end{mydef}
\end{frame}

\begin{frame}{Efficienza dell'equilibrio di monopolio}
  \begin{myteo}[Ottimalità dell'equilibrio di
    monopolio\footnote{D. Acemoglu, A. Ozdaglar, Competition and
      Efficiency in Congested Markets, Mathematics of Operations
      Research, Vol. 32, No. 1, February 2007, pp. 1–31, Proposition 3.2}]
    Un vettore $x\in \mathbb{R}_+^\mathcal{I}$ è un \textbf{equilibrio
      di monopolio} se e solo se è un \textbf{ottimo sociale}.
  \end{myteo}

  Ricordando la definizione di \textit{social surplus}
  \[ \mathbb{S}(x) = \sum _{i\in\mathcal{I}}\pa{ R -
      l_i\pa{x_i}}x_i \]
  e osserviamo che il prezzo massimo che il monopolista può far pagare
  sul link $i$ è:
  \[ R - l_i(x_i) \]
\end{frame}

\begin{frame}{Presenza di più provider}
  Supponiamo ora ci siano $S$ provider e che ognuno di questi
  controlli il prezzo di un certo sottoinsieme di link $\mathcal{I}_s$
  (per $s\in S$).

  Dato un provider $s\in S$ definiamo:
  \begin{itemize}
  \item $p_s = \bra{p_i}_{i\in \mathcal{I}_s}$
  \item $p_{-s} = \bra{p_i}_{i\not\in \mathcal{I}_s}$
   \item $\displaystyle \Pi _s \pa{p_s, p_{-s},x} = \sum _{i\in
       \mathcal{I}_s} p_i x_i\;$ con $x\in W\pa{p_s, p_{-s}}$
  \end{itemize}
  
  Ogni provider cercherà di massimizzare il proprio profitto, siamo
  quindi in una situazione in cui vogliamo cercare un
  \textbf{equilibrio di Nash}.
\end{frame}

\begin{frame}{Equilibrio di oligopolio}
  \begin{mydef}[Equilibrio di oligopolio]
    Diciamo che i vettori $\pa{p^{OE},x^{OE}}\ge 0$ sono un
    \textbf{equilibrio di oligopolio} se $x^{OE}\in W\pa{p^{OE}}$ e
    $\forall s\in S$ si ha:
    \begin{align*}
      & \forall p_s \ge 0\;\;\; \forall x\in W\pa{p_s,p^{OE}_{-s}} \\
      & \Pi_s \pa{p^{OE}_s, p^{OE}_{-s},x^{OE}} \ge \Pi _s \pa{p_s, p^{OE}_{-s},x}
    \end{align*}
  \end{mydef}
\end{frame}

\begin{frame}{Efficienza dell'equilibrio di oligopolio}
  \begin{myteo}[Efficienza dell'equilibrio di
    oligopolio\footnote{I. Menache e A. Ozdaglar, Network Games,
      Morgan \& Claypool Publishers, 2010, Teorema 3.14}]
    Data una rete composta da $I$ link paralleli gestiti da $S$
    provider, dette $x^{S}$ una soluzione socialmente ottima e
    $\pa{p^{OE},x^{OE}}$ un equilibrio di oligopolio, si ha:
    \[ \frac{\mathbb{S}\pa{x^{OE}}} {\mathbb{S}\pa{x^S}} \ge
      \frac{5}{6} \]
  \end{myteo}
\end{frame}

\begin{frame}[plain]
  \titlepage
\end{frame}



\end{document}

